<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">

        <include src="./partials/mainhead.html"> </include>
        <script src="./assets/js/main.js"></script>
        <script>
        // blow Up modal
        $(document).ready(function() {
            
        const openModalButton = document.getElementById("openModal");
            const closeModalButton = document.getElementById("closeModal");
            const modal = document.getElementById("modal");

            // Open Modal
            openModalButton.addEventListener("click", () => {
            modal.style.display = "flex"; // Show the modal
            const modalContent = modal.querySelector(".modal-content");
            modalContent.style.animation = "blowUp 0.3s ease-out forwards"; // Blow up animation
            });

            // Close Modal
            closeModalButton.addEventListener("click", () => {
            const modalContent = modal.querySelector(".modal-content");
            modalContent.style.animation = "goBack 0.3s ease-out forwards"; // Go back animation

            // Hide the modal after the animation completes
            setTimeout(() => {
                modal.style.display = "none";
            }, 300); // Match the duration of the animation
            });


            const canvas = document.getElementById("signature_pad");
            const clearButton = document.getElementById("clear");
            const saveButton = document.getElementById("save");
            
            // Initialize Signature Pad
            const signaturePad = new SignaturePad(canvas);
            
            // Clear the canvas
            clearButton.addEventListener("click", () => {
            signaturePad.clear();
            });
            
            // Save the signature as an image
            saveButton.addEventListener("click", () => {
            if (signaturePad.isEmpty()) {
                alert("Please provide a signature first.");
            } else {
                const dataURL = signaturePad.toDataURL(); // Get signature as a data URL
                console.log(dataURL); // Log the data URL to the console
                alert("Signature saved! Check the console for the data URL.");
            
                // Optionally, download the image
                const link = document.createElement("a");
                link.href = dataURL;
                link.download = "signature.png";
                link.click();
            }
            });
        })
        </script>
    </head>
  <body
    x-data="{ page: 'newload', 'loaded': true, 'darkMode': false, 'stickyMenu': false, 'sidebarToggle': false, 'scrollTop': false }"
    x-init="
         darkMode = JSON.parse(localStorage.getItem('darkMode'));
         $watch('darkMode', value => localStorage.setItem('darkMode', JSON.stringify(value)))"
    :class="{'dark bg-gray-900': darkMode === true}"
  >

  
    <!-- ===== Preloader Start ===== -->
    <include src="./partials/preloader.html"></include>
    <!-- ===== Preloader End ===== -->

    <!-- ===== Page Wrapper Start ===== -->
    <div class="flex h-screen overflow-hidden">
      <!-- ===== Sidebar Start ===== -->
      <include src="./partials/sidebar.html"></include>
      <!-- ===== Sidebar End ===== -->

      <!-- ===== Content Area Start ===== -->
      <div
        class="relative flex flex-1 flex-col overflow-y-auto overflow-x-hidden"
      >
        <!-- Small Device Overlay Start -->
        <include src="./partials/overlay.html" />
        <!-- Small Device Overlay End -->

        <!-- ===== Header Start ===== -->
        <include src="./partials/header.html" />
        <!-- ===== Header End ===== -->

        <!-- ===== Main Content Start ===== -->
        <main>
          <div class="mx-auto max-w-screen-2xl p-4 md:p-6">
            <!-- Breadcrumb Start -->
            <div x-data="{ pageName: `New Load`}">
              <include src="./partials/breadcrumb.html" />
            </div>
            <!-- Breadcrumb End -->

            <!-- Modal -->
            <div id="modal" class="modal">
                <div class="modal-content">
                <span id="closeModal" class="close">&times;</span>
                <h2>Sign and Save, then upload the signed signature</h2>
                <div id="signature-pad" class="signature-pad">
                    <canvas id="signature_pad" width="400" height="200"></canvas>
                    <div class="buttons">
                        <button type="button" id="clear" class="focus:outline-none text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-900">Reset</button>

                        <button type="button" id="save" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800">Save</button>
                    </div>
                </div>
                </div>
            </div>


            
            <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]">
              <div x-data="stepperForm" class="w-full mx-auto px-4">
                <ol class="flex items-center justify-between w-full p-3 text-sm font-medium text-center text-gray-500 bg-white border border-gray-200 rounded-lg shadow-xs dark:text-gray-400 sm:text-base dark:bg-gray-800 dark:border-gray-700 sm:p-4 rtl:space-x-reverse">
                    <template x-for="(heading, index) in ['Basic Info', 'Charges', 'Dispatch', 'Backup Docs', 'Expenses']" :key="index">
                        <li class="flex-1 flex items-center justify-center" :class="{ 'text-blue-600 dark:text-blue-500': step === index + 1, 'text-gray-500 dark:text-gray-400': step !== index + 1 }">
                            <span class="flex items-center justify-center w-6 h-6 text-xs font-bold border rounded-full"
                                :class="{ 'border-blue-600 bg-blue-600 text-white dark:border-blue-500': step === index + 1, 'border-gray-500 dark:border-gray-400': step !== index + 1 }">
                                <span x-text="index + 1"></span>
                            </span>
                            <span class="ml-2 hidden sm:inline" x-text="heading"></span>
                        </li>
                    </template>
                </ol>

                <form class="mt-6 bg-white p-6 rounded-lg shadow dark:bg-gray-800 w-full border border-gray-200 dark:border-gray-700" @submit.prevent="saveAndSubmit" enctype="multipart/form-data" id="editloadForm">
                    <!-- Step 1: Basic Info -->
                    <div x-show="step === 1" >
                                        
                        <div x-data="{ selectedOption: 'ocean'}">
                            <div  class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                <!-- <div x-data="{ isAuthenticated: false }">
                                    <span x-show="!isAuthenticated" onclick="user()" class="cursor-pointer text-lg font-bold text-blue-600 dark:text-blue-400">Get User

                                    </span>

                                <span x-show="!isAuthenticated" onclick="login()" class="cursor-pointer text-lg font-bold text-blue-600 dark:text-blue-400"> login</span>
                                <span x-show="!isAuthenticated" onclick="register()" class="cursor-pointer text-lg font-bold text-blue-600 dark:text-blue-400">Register</span>
                                </div> -->
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300">Type</label>
                                        <select x-model="selectedOption" name="shipment_type" id="shipment_type" onchange="handleShipmentType(this.value)" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                        <option value="" selected disabled>Select</option>
                                        <option value="land">Land</option>
                                        <option value="ocean">Ocean</option>
                                        <option value="air">Air Freight</option>
                                    </select>
                                </div>
                            </div>
                            <div x-show="selectedOption === 'ocean'">
                                <div id="" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Name</label>
                                        <select x-model="formData.shipper_name" name="shipper_name" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="shipper_name">
                                        <option value="" selected disabled>Select shipper</option>
                                        <option value="import">Import</option>
                                        <option value="export">Export</option>
                                        <option value="one_way">One Way</option>
                                        <option value="truckload">Truckload</option>
                                        <option value="ltl">Less Than Truck Load</option>
                                        <option value="chasisReposition">Chasis Reposition</option>
                                    </select>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Shipper Address</label>
                                        <input type="text" x-model="formData.ocean_shipper_address" name="ocean_shipper_address" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="shipper_address">
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Shipper Reference #</label>
                                        <input type="text" x-model="formData.ocean_shipper_reference_number" name="ocean_shipper_reference_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="shipper_reference_number">
                                    </div>
                                </div>
                               
                                <div id="" class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-6">
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Carrier Name</label>
                                        <select x-model="formData.carrier_name" name="carrier_name" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="carrier_name">
                                        <option value="" selected disabled>Selet carrier</option>
                                        <option value="import">Joen Doe</option>
                                        <option value="export">Export</option>
                                    </select>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Carrier Reference #</label>
                                        <input type="text" x-model="formData.carrier_reference_number" name="carrier_reference_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="carrier_reference_number">
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">BOL #</label>
                                        <input type="text" x-model="formData.ocean_bill_of_ladening_number" name="ocean_bill_of_ladening_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white numberOnly" placeholder="" id="bill_of_ladening_number">
                                    </div>
                                </div>
                                <div>
                                    <span class="block text-gray-700 dark:text-gray-300  mt-6 text-lg font-bold">Consignee Details</span>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Consignee</label>
                                            <input type="text" x-model="formData.consignee" name="consignee" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="consignee">
                                        </div> 
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Phone #</label>
                                            <input type="text" x-model="formData.consignee_phone" name="consignee_phone" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="consignee_phone">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Email</label>
                                            <input type="email" x-model="formData.consignee_email" name="consignee_email" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="consignee_email">
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <span class="block text-gray-700 dark:text-gray-300  mt-6 text-lg font-bold">Notify Party</span>
                                    <!-- Remember to email both notify and consignee -->
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Name</label>
                                            <input type="text" x-model="formData.first_notify_party_name" name="first_notify_party_name" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="first_notify_party_name">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Phone #</label>
                                            <input type="text" x-model="formData.first_notify_party_phone" name="first_notify_party_phone" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="first_notify_party_phone">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Email</label>
                                            <input type="email" x-model="formData.first_notify_party_email" name="first_notify_party_email" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="first_notify_party_email">
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-6">
                                    <span class="block text-gray-700 dark:text-gray-300 mt-6 text-lg font-bold">Additional Notify Party</span>
                                    <!-- Remember to email both notify and consignee -->
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Name</label>
                                            <input type="text" x-model="formData.second_notify_party_phone" name="second_notify_party_phone" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="second_notify_party_phone">
                                        </div>
                                        
                                        
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Phone #</label>
                                            <input type="text" x-model="formData.second_notify_party_phone" name="second_notify_party_phone" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="second_notify_party_phone">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Email</label>
                                            <input type="email" x-model="formData.second_notify_party_email" name="second_notify_party_email" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="second_notify_party_email">
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <!-- <span class="block text-gray-700 dark:text-gray-300 mt-6 text-lg font-bold">Additional Notify Party</span> -->
                                    <!-- Remember to email both notify and consignee -->
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Pre Carried</label>
                                            <select x-model="formData.pre_carrier" name="pre_carrier" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="pre_carrier">
                                                <option value="" selected disabled>Selet carrier</option>
                                                <option value="import">Joen Doe</option>
                                                <option value="export">Export</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Vessel / Aircraft</label>
                                            <input type="text" x-model="formData.vessel_aircraft_name" name="vessel_aircraft_name" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="vessel_aircraft_name">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Voyage No</label>
                                            <input type="text" x-model="formData.voyage_number" name="voyage_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="voyage_number">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Port of landing</label>
                                            <input type="text" x-model="formData.port_of_discharge" name="port_of_discharge" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="port_of_discharge">
                                        </div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Port Discharged</label>
                                        <select x-model="formData.port_of_discharge" name="port_of_discharge" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="port_of_discharge">
                                            <option value="" selected disabled>Selet carrier</option>
                                            <option value="import">Joen Doe</option>
                                            <option value="export">Export</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Place of Delivery</label>
                                        <input type="text" x-model="formData.place_of_delivery" name="place_of_delivery" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="place_of_delivery">
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Final Destination</label>
                                        <input type="text" x-model="formData.final_destination" name="final_destination" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="final_destination">
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Port of landing</label>
                                        <input type="text" x-model="formData.port_of_landing" name="port_of_landing" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="port_of_landing">
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Additional Note</label>
                                        <textarea type="text" rows="4" cols="4" x-model="formData.ocean_note" name="ocean_note" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="ocean_note"></textarea>
                                    </div>
                                </div>
                                
                                <div>
                                    <span class="block text-gray-700 dark:text-gray-300  mt-6 text-lg font-bold">Marks and Numbers</span>
                                    <!-- Remember to email both notify and consignee -->
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">ITN</label>
                                            <input type="text" x-model="formData.itn" name="itn" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="itn">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Kind and No of Packages</label>
                                            <input type="text" x-model="formData.kind_and_no_of_packages" name="kind_and_no_of_packages" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="kind_and_no_of_packages">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Description</label>
                                            <textarea rows="1" cols="1" type="text" x-model="formData.decsription_of_goods" name="decsription_of_goods" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="decsription_of_goods"> </textarea>
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Net weight (kg)</label>
                                            <input type="text" x-model="formData.ocean_net_weight" name="ocean_net_weight" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="ocean_net_weight">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Gross weight (kg)</label>
                                            <input type="text" x-model="formData.ocean_gross_weight" name="ocean_gross_weight" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="ocean_gross_weight">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Measurement (m<sup>3</sup>)</label>
                                            <input type="text" x-model="formData.ocean_gross_weight" name="ocean_gross_weight" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="ocean_gross_weight">
                                        </div>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6 mb-6">
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Total</label>
                                        <input type="text" x-model="formData.ocean_total" name="ocean_total" id="ocean_total" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="ocean_total" readonly>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Consignment Total</label>
                                        <input type="text" x-model="formData.ocean_consignment_total" name="ocean_consignment_total" id="ocean_consignment_total" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="ocean_consignment_total" readonly>
                                    </div>
                                </div>
                                <div>
                                    <!-- <span class="block text-gray-700 dark:text-gray-300  mt-6 text-lg font-bold">Marks and Numbers</span> -->
                                    <!-- Remember to email both notify and consignee -->
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Container #</label>
                                            <input type="text" x-model="formData.ocean_container_number" name="ocean_container_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="ocean_container_number">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Seal #</label>
                                            <input type="text" x-model="formData.ocean_seal_number" name="ocean_seal_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="ocean_seal_number">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Equipment Size</label>
                                            <input type="text" x-model="formData.equipment_size" name="equipment_size" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="equipment_size">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">No containers or packages in word</label>
                                            <input type="text" x-model="formData.ocean_total_containers_in_words" name="ocean_total_containers_in_words" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="ocean_total_containers_in_words">
                                        </div>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-6">
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">No of original Bill of landing</label>
                                            <input type="text" x-model="formData.no_original_bill_of_landing" name="no_original_bill_of_landing" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="no_original_bill_of_landing">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Payable at</label>
                                            <input type="text" x-model="formData.original_bill_of_landing_payable_at" name="original_bill_of_landing_payable_at" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="original_bill_of_landing_payable_at">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Freight Charges</label>
                                            <select x-model="formData.ocean_freight_charges" name="ocean_freight_charges" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white numberOnly placeholder="" id="ocean_freight_charges">
                                                <option value="" selected disabled>Selet Charges</option>
                                                <option value="1">Prepay</option>
                                                <option value="2">Postpay</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Shipped on board Date</label>
                                            <input type="text" x-model="formData.shipped_on_board_date" id="shipped_on_board_date" name="shipped_on_board_date" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                        </div>
                                    </div>

                                    
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-6">
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Place of Issue</label>
                                            <input type="text" x-model="formData.place_of_issue" name="place_of_issue" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="place_of_issue">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Signatory Company</label>
                                            <input type="text" x-model="formData.signatory_company" name="signatory_company" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="signatory_company">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Authorize Signatory</label>
                                            <input type="text" x-model="formData.authorized_signatory" id="authorized_signatory" name="authorized_signatory" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="authorized_signatory">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300 flex">Signature <span id="openModal" class="">
                                                <svg xmlns="http://www.w3.org/2000/svg" style="margin-left: 10px;" width="16" height="16" fill="currentColor" class="bi bi-pen-fill text-blue-600 cursor-pointer dark:text-white" viewBox="0 0 16 16">
                                                    <path d="m13.498.795.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001"/>
                                                  </svg>
                                                  
                                            </span></label>
                                            <input type="file" id="ocean_signature" name="ocean_signature" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                        </div>
                                    </div>
                                </div>
                                <!-- description of goods -->
                                <div>
                                    <div id="description_of_goods">
                                        <span onclick="duplicateGoods()" 
                                            class="ml-2 cursor-pointer text-lg font-bold text-blue-600 dark:text-blue-400">
                                            +
                                        </span>
                                        <span onclick="removeGoods(this)" 
                                            class="ml-2 cursor-pointer text-lg font-bold text-blue-600 dark:text-red-500">
                                            x
                                            <!-- ðŸ—‘ -->
                                        </span>

                                        <div id="" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                            <div>
                                                <label class="block text-gray-700 dark:text-gray-300">Name</label>
                                                <input type="text" x-model="formData.goods_name" name="goods_name[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                            </div>
                                            <div>
                                                <label class="block text-gray-700 dark:text-gray-300">VIN</label>
                                                <input type="text" x-model="formData.ocean_vin" name="ocean_vin[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                            </div>
                                            <div>
                                                <label class="block text-gray-700 dark:text-gray-300">Weight (kg)</label>
                                                <input type="text" x-model="formData.ocean_weight" name="ocean_weight[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                            </div>
                                        </div>
                                    </div>
                                <div id="goodsList"></div>
                                </div>
                            </div>

                            <div x-show="selectedOption === 'land'">
                                <div id="" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Office</label>
                                        <input type="text" x-model="formData.office" name="office" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Enter your name" id="office">
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Load Type</label>
                                        <select x-model="formData.load_type" onchange="handleLoadTypeChange(this.value)" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="load_type">
                                        <option value="" selected disabled>Select Load Type</option>
                                        <option value="import">Import</option>
                                        <option value="export">Export</option>
                                        <option value="one_way">One Way</option>
                                        <option value="truckload">Truckload</option>
                                        <option value="ltl">Less Than Truck Load</option>
                                        <option value="chasisReposition">Chasis Reposition</option>
                                    </select>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Load Note</label>
                                        <input type="text" x-model="formData.load_type_note" name="load_type_note" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Notes" id="load_type_note"	>
                                    </div>
                                <!-- Load Note Radio Buttons and Checkbox -->
                                    <div>
                                        <!-- <label class="block text-gray-700 dark:text-gray-300">Load Note</label> -->
                                        <div class="flex items-center space-x-4 mt-6">
                                            <!-- Radio Option 1 -->
                                            <label class="flex items-center space-x-2">
                                                <input type="radio" x-model="formData.load_type_note_r" name="load_type_note_r" value="Left" class="text-blue-500 dark:bg-gray-700 dark:border-gray-600">
                                                <span class="text-gray-700 dark:text-gray-300">L</span>
                                            </label>

                                            <!-- Radio Option 2 -->
                                            <label class="flex items-center space-x-2">
                                                <input type="radio" x-model="formData.load_type_note_r" name="load_type_note_r" value="Right" class="text-blue-500 dark:bg-gray-700 dark:border-gray-600">
                                                <span class="text-gray-700 dark:text-gray-300">R</span>
                                            </label>

                                            <!-- Checkbox Option -->
                                            <label class="flex items-center space-x-2">
                                                <input type="checkbox" x-model="formData.isBroker" name="isBroker" class="text-blue-500 dark:bg-gray-700 dark:border-gray-600">
                                                <span class="text-gray-700 dark:text-gray-300">Broker</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                            

                                <!-- bill to -->
                                <div>
                                    <div id="billto">
                                        <span onclick="duplicateBillto()" 
                                            class="ml-2 cursor-pointer text-lg font-bold text-blue-600 dark:text-blue-400">
                                            +
                                        </span>
                                        <span onclick="removeBillto(this)" 
                                            class="ml-2 cursor-pointer text-lg font-bold text-blue-600 dark:text-red-500">
                                            x
                                            <!-- ðŸ—‘ -->
                                        </span>

                                        <div id="" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                            <div>
                                                <label class="block text-gray-700 dark:text-gray-300">Bill to</label>
                                                <input type="text" x-model="formData.bill_to" name="bill_to[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                            </div>
                                            <div>
                                                <label class="block text-gray-700 dark:text-gray-300">Quick Note</label>
                                                <input type="text" x-model="formData.quick_note" name="quick_note[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Notes">
                                            </div>
                                        </div>
                                    </div>
                                <div id="billtoList"></div>
                                </div>

                                <!-- container and chassis -->
                                <div>
                                    <!-- Hidden Container (Template for Cloning) -->
                                    <div id="container" style="display: none;">
                                        <span onclick="duplicateContainer()" 
                                            class="ml-2 cursor-pointer text-lg font-bold text-blue-600 dark:text-blue-400">
                                            +
                                        </span>
                                        <span onclick="removeContainer(this)" 
                                            class="ml-2 cursor-pointer text-lg font-bold text-blue-600 dark:text-red-500">
                                            x
                                            <!-- ðŸ—‘ -->
                                        </span>

                                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Container</label>
                                            <input type="text" x-model="formData.container" name="container[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                        </div>
                                        
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Size</label>
                                            <select x-model="formData.container_size" name="container_size[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                            <option value="" selected disabled>Select Size</option>
                                            <option value="20">20<sup>'</sup></option>
                                            <option value="40">40<sup>'</sup></option>
                                            <option value="45">45<sup>'</sup></option>
                                            <option value="48">48<sup>'</sup></option>
                                            <option value="53">53<sup>'</sup></option>
                                            <option value="20/40">20<sup>'</sup>/40<sup>'</sup></option>
                                            <option value="40/45">40<sup>'</sup>/45<sup>'</sup></option>
                                            <option value="other">Other</option>
                                        </select>
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Type</label>
                                            <select x-model="formData.container_type" name="container_type[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                            <option value="" selected disabled>Select Type</option>
                                            <option value="ST">ST</option>
                                            <option value="HC">HC</option>
                                            <option value="RF">RF</option>
                                            <option value="truckload">Truckload</option>
                                            <option value="RHC">RHC</option>
                                            <option value="OT">OT</option>
                                            <option value="FR">FR</option>
                                            <option value="Tank">Tank</option>
                                            <option value="ISO Tank">ISO Tank</option>
                                            <option value="FB">FB</option>
                                            <option value="Stepdeck">Stepdeck</option>
                                            <option value="Dounble drop RGN">Dounble drop RGN</option>
                                        </select>
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Chasis</label>
                                            <input type="text" x-model="formData.chasis" name="chasis[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                        </div>
                                    </div>
            
            
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Loaded/Empty? Flio Chasis</label>
                                            <textarea type="text" x-model="formData.isLoaded" name="isLoaded[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder=""> </textarea>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Size</label>
                                            <select x-model="formData.chasis_size" name="chasis_size[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                            <option value="" selected disabled>Select Size</option>
                                            <option value="20">20<sup>'</sup></option>
                                            <option value="40">40<sup>'</sup></option>
                                            <option value="45">45<sup>'</sup></option>
                                            <option value="48">48<sup>'</sup></option>
                                            <option value="53">53<sup>'</sup></option>
                                            <option value="20/40">20<sup>'</sup>/40<sup>'</sup></option>
                                            <option value="40/45">40<sup>'</sup>/45<sup>'</sup></option>
                                            <option value="other">Other</option>
                                        </select>
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Type</label>
                                            <select x-model="formData.chasis_type" name="chasis_type[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                            <option value="" selected disabled>Select Type</option>
                                            <option value="Tri-axle">Tri-axle</option>
                                            <option value="8-pin">8-pin</option>
                                            <option value="Flatbed">Flatbed</option>
                                            <option value="Deck combo chasis">Deck combo chasis</option>
                                            <option value="Drop Deck">Drop Deck</option>
                                            <option value="ISO Chasis">ISO Chasis</option>
                                            <option value="Slider Chasis">Slider Chasis</option>
                                            <option value="Gooseneck">Gooseneck</option>
                                            <option value="Dolly">Dolly</option>
                                            <option value="Reefer">Reefer</option>
                                            <option value="2 axle p/u">2 axle p/u</option>
                                            <option value="Other">Other</option>
                                        </select>
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Chasis Vendor</label>
                                            <input type="text" x-model="formData.chasis_vendor" name="chasis_vendor[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                        </div>
                                    </div>
                                    </div>
                                    
                                
                                    <!-- Duplicated Containers Appear Here -->
                                    <div id="containerList"></div>
                                </div>
                                
                            <!-- numbers -->
                            <div id="" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300">Reference #</label>
                                    <input type="text" x-model="formData.reference_number" name="reference_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="reference_number">
                                </div>
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300">Booking #</label>
                                    <input type="text" x-model="formData.booking_number" name="booking_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="booking_number">
                                </div>
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300">BOL #</label>
                                    <input type="text" x-model="formData.bill_of_laden_number" name="bill_of_laden_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="bill_of_laden_number">
                                </div>
                            <!-- Load Note Radio Buttons and Checkbox -->
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300">PO #</label>
                                    <input type="text" x-model="formData.po_number" name="po_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="po_number">
                                </div>
                            </div>

                            <!-- numbers -->
                            <div id="" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300">Load Weight</label>
                                    <input type="text" x-model="formData.load_weight" name="load_weight" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="load_weight">
                                </div>
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300">Commodity</label>
                                    <input type="text" x-model="formData.commodity" name="commodity" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="commodity">
                                </div>
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300">Pieces</label>
                                    <input type="number" x-model="formData.pieces" name="pieces" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white numberOnly" placeholder="" id="pieces">
                                </div>
                            <!-- Load Note Radio Buttons and Checkbox -->
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300">Pick up #</label>
                                    <input type="text" x-model="formData.pick_up_number" name="pick_up_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="pick_up_number">
                                </div>
                                
                                <!-- <div>
                                    <label class="block text-gray-700 dark:text-gray-300">PO #</label>
                                    <input type="text" x-model="formData.po_num" name="po_num" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                </div> -->
                            </div>

                            <style>
                                .chosen-container-single .chosen-single {
                                    height: 40px !important;
                                    background: none !important;
                                    border: none !important;
                                    vertical-align: middle !important;
                                }
                            </style>

                            <!-- numbers -->
                            <div id="" class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                                <div id="chosen-select">
                                    <label class="block text-gray-700 dark:text-gray-300">OverWeight/Hazmat etc</label>
                                    <select x-model="formData.over_weight" name="over_weight" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white chosen-select" multiple id="over_weight">
                                        <!-- <option value="" selected disabled>Select Type</option> -->
                                        <option value="Tri-axle">Tri-axle</option>
                                        <option value="8-pin">8-pin</option>
                                        <option value="Flatbed">Flatbed</option>
                                        <option value="Deck combo chasis">Deck combo chasis</option>
                                        <option value="Drop Deck">Drop Deck</option>
                                        <option value="ISO Chasis">ISO Chasis</option>
                                        <option value="Slider Chasis">Slider Chasis</option>
                                        <option value="Gooseneck">Gooseneck</option>
                                        <option value="Dolly">Dolly</option>
                                        <option value="Reefer">Reefer</option>
                                        <option value="2 axle p/u">2 axle p/u</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <!-- <div>
                                    <label class="block text-gray-700 dark:text-gray-300">Tags</label>
                                    <input type="text" x-model="formData.tags" name="tags" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="tags">
                                </div> -->

                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300">Tags</label>
                                    <input 
                                      type="text" 
                                      x-model="formData.tagsInput" 
                                      @keydown.space.prevent="addTag()"
                                      @keydown.enter.prevent="addTag()"
                                      @keydown.backspace="removeLastTag()"
                                      class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" 
                                      placeholder="Type tags separated by space"
                                      id="tags"
                                    >
                                    <!-- Display tags as chips -->
                                    <div class="flex flex-wrap gap-2 mt-2">
                                      <template x-for="(tag, index) in formData.tags" :key="index">
                                        <div class="flex items-center bg-gray-200 dark:bg-gray-700 px-3 py-1 rounded-full">
                                          <span x-text="tag" class="text-sm"></span>
                                          <button 
                                            @click="removeTag(index)" 
                                            class="ml-2 text-gray-500 hover:text-red-500"
                                            type="button"
                                          >
                                            &times;
                                          </button>
                                        </div>
                                      </template>
                                    </div>
                                  </div>
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300">Genset #</label>
                                    <input type="text" x-model="formData.genset_number" name="genset_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="genset_number">
                                </div>
                            <!-- Load Note Radio Buttons and Checkbox -->
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300">Refeer Temp</label>
                                    <input type="text" x-model="formData.reefer_temp" name="reefer_temp" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="reefer_temp">
                                </div>
                                
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300">Seal #</label>
                                    <input type="text" x-model="formData.seal_number" name="seal_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="seal_number">
                                </div>
                            </div>
                            <!-- Pick up Deliveries -->
                            <div>
                                <h6 class="text-md font-medium mb-3 dark:text-white">Pickup / Deliveries</h6>
                                    <div id="pickUPP">
                                        <span onclick="duplicatePickup()" 
                                            class="ml-2 cursor-pointer text-lg font-bold text-blue-600 dark:text-blue-400">
                                            +
                                        </span>
                                        <span onclick="removePickup(this)" 
                                            class="ml-2 cursor-pointer text-lg font-bold text-blue-600 dark:text-red-500">
                                            x
                                            <!-- ðŸ—‘ -->
                                        </span>
                                <div id="" class="grid grid-cols-1 md:grid-cols-6 gap-4 mb-6">
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Pick up</label>
                                        <select x-model="formData.pick_up" name="pick_up" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="pick_up">
                                            <option value="" selected disabled></option>
                                            <option value="pickup">Pickup</option>
                                            <option value="pickup loaded">Pickup Loaded</option>
                                            <option value="pickup empty">Pickup Empty</option>
                                            <hr class="mt-3 mb-3 text-white">
                                            <option value="deliver">Deliver</option>
                                            <option value="load_at">Load at</option>
                                            <hr>
                                            <option value="drop_at">Drop at</option>
                                            <option value="drop_empty">Drop Empty</option>
                                            <option value="drop_loaded">Drop Loaded</option>
                                            <option value="stop_off">Stop off</option>
                                            <option value="scale_stop">Scale Stop</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Quick lookup</label>
                                        <select x-model="formData.look_up" name="look_up" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="look_up">
                                            <option value="" selected disabled></option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Location Name</label>
                                        <input type="text" x-model="formData.pick_up_location_name" name="pick_up_location_name[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Address</label>
                                        <input type="text" x-model="formData.pick_up_address" name="pick_up_address[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">City</label>
                                        <input type="text" x-model="formData.pick_up_city" name="pick_up_city[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Zip</label>
                                        <input type="text" x-model="formData.zip" name="zip[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                    </div>
                                </div>
                                    <div id="" class="grid grid-cols-1 md:grid-cols-6 gap-4 mb-6">
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300"> Appt</label>
                                            <input type="text" x-model="formData.appt_date" name="appt_date[]" id="appt_date" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">From</label>
                                            <select x-model="formData.from" name="from[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                                <option value="" selected disabled></option>
                                            
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">To</label>
                                            <input type="text" x-model="formData.to" name="to[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">No latter than</label>
                                            <input type="text" x-model="formData.no_latter_than_date" name="no_latter_than_date[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Time</label>
                                            <input type="text" x-model="formData.no_latter_than_time" name="no_latter_than_time[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                        </div>
                                    </div>
                                </div>
                                <div id="pickupList"></div>
                            </div>

                            <div>
                                <h6 class="text-md font-medium mb-3 dark:text-white">Drop Location</h6>
                                    <div id="dropAt">
                                        <span onclick="duplicateDropAt()" 
                                            class="ml-2 cursor-pointer text-lg font-bold text-blue-600 dark:text-blue-400">
                                            +
                                        </span>
                                        <span onclick="removeDropAt(this)" 
                                            class="ml-2 cursor-pointer text-lg font-bold text-blue-600 dark:text-red-500">
                                            x
                                            <!-- ðŸ—‘ -->
                                        </span>
                                        <div id="" class="grid grid-cols-1 md:grid-cols-6 gap-4 mb-6">
                                            <div>
                                                <label class="block text-gray-700 dark:text-gray-300">Drop At</label>
                                                <select x-model="formData.drop_at" name="drop_at" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="drop_at">
                                                    <option value="" selected disabled></option>
                                                    <option value="pickup">Pickup</option>
                                                    <option value="pickup loaded">Pickup Loaded</option>
                                                    <option value="pickup empty">Pickup Empty</option>
                                                    <hr class="mt-3 mb-3 text-white">
                                                    <option value="deliver">Deliver</option>
                                                    <option value="load_at">Load at</option>
                                                    <hr>
                                                    <option value="drop_at">Drop at</option>
                                                    <option value="drop_empty">Drop Empty</option>
                                                    <option value="drop_loaded">Drop Loaded</option>
                                                    <option value="stop_off">Stop off</option>
                                                    <option value="scale_stop">Scale Stop</option>
                                                    <option value="Other">Other</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label class="block text-gray-700 dark:text-gray-300">Quick lookup</label>
                                                <select x-model="formData.drop_at_look_up" name="drop_at_look_up[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                                    <option value="" selected disabled></option>
                                                
                                                </select>
                                            </div>
                                            <div>
                                                <label class="block text-gray-700 dark:text-gray-300">Location Name</label>
                                                <input type="text" x-model="formData.drop_at_location_name" name="drop_at_location_name[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                            </div>
                                            <div>
                                                <label class="block text-gray-700 dark:text-gray-300">Address</label>
                                                <input type="text" x-model="formData.drop_at_address" name="drop_at_address[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                            </div>
                                            <div>
                                                <label class="block text-gray-700 dark:text-gray-300">City</label>
                                                <input type="text" x-model="formData.drop_at_city" name="drop_at_city[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                            </div>
                                            
                                            <div>
                                                <label class="block text-gray-700 dark:text-gray-300">Zip</label>
                                                <input type="text" x-model="formData.drop_at_zip" name="drop_at_zip[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                            </div>
                                        </div>
                                
                                        <div id="" class="grid grid-cols-1 md:grid-cols-6 gap-4 mb-6">
                                            <div>
                                                <label class="block text-gray-700 dark:text-gray-300"> Appt</label>
                                                <input type="text" x-model="formData.drop_at_appt_date" name="drop_at_appt_date[]" id="appt_date" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                            </div>
                                            <div>
                                                <label class="block text-gray-700 dark:text-gray-300">From</label>
                                                <select x-model="formData.drop_at_from" name="drop_at_from[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                                    <option value="" selected disabled></option>
                                                
                                                </select>
                                            </div>
                                            <div>
                                                <label class="block text-gray-700 dark:text-gray-300">To</label>
                                                <input type="text" x-model="formData.drop_at_to" name="drop_at_to[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                            </div>
                                            <div>
                                                <label class="block text-gray-700 dark:text-gray-300">No latter than</label>
                                                <input type="text" x-model="formData.drop_at_no_latter_than_date" name="drop_at_no_latter_than_date[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                            </div>
                                            <div>
                                                <label class="block text-gray-700 dark:text-gray-300">Time</label>
                                                <input type="text" x-model="formData.drop_at_no_latter_than_time" name="drop_at_no_latter_than_time[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                            </div>
                                        </div>
                                    </div>
                                <div id="dropAtList"></div>
                            </div>
                            <script>
                                $(document).ready(function () {
                        
                                    $(function () {
                                        $("#appt_date").
                                        datepicker();
                                    });
                                }) 
                            </script>
                            <div>
                                <!-- <h4 class="mt-4 mb-3 block text-gray-700 dark:text-gray-300">Freight broker info ( if different from bill-to party )</h4> -->
                                <div id="" class="grid grid-cols-1 md:grid-cols-10 gap-4 mb-6">
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">&nbsp;</label>
                                        <a href="https://www.google.com/maps/dir//" class="mt-4 mb-3 block text-blue-700  dark:text-blue-300 inline-flex items-center mb-5 cursor-pointer" target="_blank">Show Route</a>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Total Miles</label>
                                        <input type="text" x-model="formData.total_miles" name="total_miles" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="total_miles">
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Loaded Miles</label>
                                        <input type="text" x-model="formData.loaded_miles" name="loaded_miles" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white numberOnly" placeholder="" id="loaded_miles">
                                    </div>
                                <!-- Load Note Radio Buttons and Checkbox -->
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Empty Miles</label>
                                        <input type="text" x-model="formData.empty_miles" name="empty_miles" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="empty_miles">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">D/H Miles</label>
                                        <input type="text" x-model="formData.dh_miles" name="dh_miles" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="dh_miles">
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">&nbsp;</label>
                                        <a href="https://www.eia.gov/petroleum/gasdiesel/" target="_blank" class="block text-blue-700 dark:text-blue-300 inline-flex items-center mb-5 cursor-pointer">Fuel Rate</a>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">$ / Gallon</label>
                                        <input x-model="formData.fuel_rate_per_gallon" name="fuel_rate_per_gallon" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="fuel_rate_per_gallon" />
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">MPG</label>
                                        <input type="text" x-model="formData.mpg" name="mpg" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="mpg" />
                                    </div>
                                <!-- Load Note Radio Buttons and Checkbox -->
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Fuel cost</label>
                                        <input type="text" x-model="formData.total_fuel_cost" name="total_fuel_cost" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="total_fuel_cost" />
                                    </div>
                                    
                                    <!-- <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Seal #</label>
                                        <input type="text" x-model="formData.seal_number" name="seal_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                    </div> -->
                                </div>
                            </div>

                            
                                <div>
                                    <h4 class="mt-4 mb-3 block text-gray-700 dark:text-gray-300">Freight broker info ( if different from bill-to party )</h4>
                                    <div id="" class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Broker Name</label>
                                            <input type="text" x-model="formData.broker_name" name="broker_name" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="broker_name">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Broker Email</label>
                                            <input type="email" x-model="formData.broker_email" name="broker_email" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="broker_email">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Phone No</label>
                                            <input type="text" x-model="formData.broker_number" name="broker_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white numberOnly" placeholder="" id="broker_number">
                                        </div>
                                    <!-- Load Note Radio Buttons and Checkbox -->
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Broker Ref #</label>
                                            <input type="text" x-model="formData.broker_reference_number" name="broker_reference_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="broker_reference_number">
                                        </div>
                                        
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Batch #</label>
                                            <input type="text" x-model="formData.batch_number" name="batch_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="batch_number">
                                        </div>
                                    </div>
                                    <div id="" class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Batch Req</label>
                                            <input type="text" x-model="formData.batch_req" name="batch_req" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="batch_req">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Sales Rep</label>
                                            <select x-model="formData.sales_rep" name="sales_rep" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="sales_rep">
                                                <!-- <option value="" selected disabled>Select Type</option> -->
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">EDI/API Shipment #</label>
                                            <input type="text" x-model="formData.edi_number" name="edi_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="edi_number">
                                        </div>
                                    <!-- Load Note Radio Buttons and Checkbox -->
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Note</label>
                                            <textarea type="text" x-model="formData.note" name="note" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" id="note"></textarea>
                                        </div>
                                        
                                        <!-- <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Seal #</label>
                                            <input type="text" x-model="formData.seal_number" name="seal_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                        </div> -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                
                    <!-- Step 2: Charges -->
                    <div x-show="step === 2" class="space-y-6">
                        <template x-for="(charge, index) in formData.shipment_charges" :key="index">
                            <div class="p-4 border rounded-lg bg-white dark:bg-gray-800 shadow-sm dark:border-gray-700">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="font-medium text-gray-900 dark:text-gray-100">Charge #<span x-text="index + 1"></span></h3>
                                    <button @click="removeCharge(index)" type="button" 
                                            class="text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 text-sm">
                                        Remove
                                    </button>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                                    <!-- Charge Type -->
                                    <div>
                                        <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">Charge Type</label>
                                        <select x-model="charge.charge_type" name="charge_type[]"
                                                class="w-full rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 focus:ring-blue-500 focus:border-blue-500">
                                                <option value="" selected disabled></option>
                                                <option value="drayage">Drayage</option>
                                                <option value="fuel_surcharge">Fuel Surcharge</option>
                                                <option value="admin_fee">Admin Fee</option>
                                                <option value="attempted_pickup">Attempted Pickup</option>
                                                <option value="bonded_cargo_pickup">Bonded Cargo Pickup</option>
                                                <option value="bonded_cargo_charge">Bonded Cargo Charge</option>
                                                <option value="chasis_rental">Chasis Rental</option>
                                                <option value="chasis_rental">Chasis Rental</option>
                                                <option value="chasis_split">Chasis Split</option>
                                                <option value="chasis_stack">Chasis Stack</option>
                                                <option value="demurage">Demurage</option>
                                                <option value="driver_assistance">Driver Assistance</option>
                                                <option value="drop_charge">Drop Charge</option>
                                                <option value="dry_run">Dry Run</option>
                                                <option value="freight">Freight</option>
                                                <option value="hauling_refrigerated_cargo">Hauling Refrigerated Cargo</option>
                                                <option value="harzadous_material">Harzardous Material</option>
                                                <option value="maintainance_repair">Maintainance & Repair</option>
                                                <option value="other">Other</option>
                                                <option value="Overweight">Overweight</option>
                                                <option value="per_diem">Per Diem</option>
                                                <option value="permits">Permits</option>
                                                <option value="prepull">Prepull</option>
                                                <option value="deliver">Delivery Charge</option>
                                                <option value="shipping">SHIPPING</option>
                                                <option value="scale load">Scale Load</option>
                                                <option value="spot_empty">Spot Empty</option>
                                                <option value="stop_off">Stop Off</option>
                                                <option value="storage">Storage</option>
                                                <option value="toll">Toll</option>
                                                <option value="triaxle">Triaxle</option>
                                            <!-- Add other options -->
                                        </select>
                                    </div>

                                    <!-- Comment -->
                                    <div>
                                        <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">Comment</label>
                                        <input type="text" x-model="charge.comment" name="comment[]"
                                            class="w-full rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 focus:ring-blue-500 focus:border-blue-500">
                                    </div>

                                    <!-- Units -->
                                    <div>
                                        <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">Units</label>
                                        <input type="number" x-model="charge.units" name="units[]"
                                            @change="calculateChargeAmount(index)"
                                            class="w-full rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 focus:ring-blue-500 focus:border-blue-500">
                                    </div>

                                    <!-- Rate -->
                                    <div>
                                        <!-- <span x-text="JSON.stringify(charge)"></span> -->
                                        <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">Rate</label>
                                        <input type="text" x-model="charge.rate" name="rate[]"
                                            @change="calculateChargeAmount(index)"
                                            class="w-full rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 focus:ring-blue-500 focus:border-blue-500 numberOnly">
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <!-- Amount -->
                                    <div>
                                        <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">Amount</label>
                                        <input type="text" x-model="charge.amount" name="amount[]" readonly 
                                            class="w-full rounded bg-gray-100 dark:bg-gray-600 dark:text-gray-200 border-gray-300 dark:border-gray-500 ">
                                    </div>

                                    <!-- Discount -->
                                    <div>
                                        <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">Discount</label>
                                        <input type="text" x-model="charge.discount" name="discount[]"
                                            @change="calculateTotals()"
                                            class="w-full rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 focus:ring-blue-500 focus:border-blue-500 numberOnly">
                                    </div>

                                    <!-- Internal Notes -->
                                    <div>
                                        <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">Internal Notes</label>
                                        <input type="text" x-model="charge.internal_notes" name="internal_notes[]"
                                            class="w-full rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-gray-200 focus:ring-blue-500 focus:border-blue-500">
                                    </div>

                                    <!-- Billed -->
                                    <div class="flex items-end">
                                        <label class="flex items-center text-gray-700 dark:text-gray-300">
                                            <input type="checkbox" x-model="charge.billed" name="billed[]"
                                                class="rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700 text-blue-600 focus:ring-blue-500">
                                            <span class="ml-2 text-sm">Billed</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </template>

                        <!-- Add Charge Button -->
                        <button @click="addCharge" type="button"
                                class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded dark:bg-blue-700 dark:hover:bg-blue-800 transition-colors">
                            + Add New Charge
                        </button>

                        <!-- Totals Section -->
                       <div class="mt-8 pt-4 border-t border-gray-200 dark:border-gray-700 grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block font-medium text-gray-700 dark:text-gray-300">Total Charges</label>
                                <div class="text-xl text-gray-900 dark:text-gray-100" 
                                    x-text="'$' + formData.total"></div>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 dark:text-gray-300">Total Discount</label>
                                <div class="text-xl text-gray-900 dark:text-gray-100" 
                                    x-text="'$' + formData.total_discount"></div>
                            </div>
                            <div>
                                <label class="block font-medium text-gray-700 dark:text-gray-300">Net Total</label>
                                <div class="text-2xl font-bold text-gray-900 dark:text-gray-100" 
                                    x-text="'$' + formData.net_total"></div>
                            </div>
                        </div>
                    </div>

                    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
                    
                    <!-- Step 3: Dispatch -->
                    <div x-show="step === 3" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div x-data="{ formData: { delivery_type: '', driver_id: '' } }">

                            <div class="flex items-center space-x-4 mt-6">
                                <!-- Radio Option 1 -->
                                <label class="flex items-center space-x-2">
                                    <input type="radio" x-model="formData.delivery_type" name="delivery_type" value="Carrier"
                                    @click="formData.carrier_id = ''"
                                        class="text-blue-500 dark:bg-gray-700 dark:border-gray-600">
                                    <span class="text-gray-700 dark:text-gray-300">Carrier?</span>
                                </label>
                        
                                <!-- Radio Option 2 -->
                                <label class="flex items-center space-x-2">
                                    <input type="radio" x-model="formData.delivery_type" name="delivery_type" value="Truck"
                                    @click="formData.driver_id = ''" 
                                        class="text-blue-500 dark:bg-gray-700 dark:border-gray-600">
                                    <span class="text-gray-700 dark:text-gray-300">Truck</span>
                                </label>
                                <!-- Radio Option 3 Bike -->
                                <!-- <label class="flex items-center space-x-2">
                                    <input type="radio" x-model="formData.delivery_type" name="delivery_type" value="Bike"
                                        class="text-blue-500 dark:bg-gray-700 dark:border-gray-600">
                                    <span class="text-gray-700 dark:text-gray-300">Bike</span>
                                </label> -->
                            </div>
                        
                            <!-- Show when "Truck" is selected -->
                            <div x-show="formData.delivery_type === 'Truck'" class="isDrive mt-4">
                                <label class="block text-gray-700 dark:text-gray-300">Assign Driver</label>
                                <select x-model="formData.driver_id" name="driver_id" id="driver_id"
                                    class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="truck_driver">
                                    <option value="" selected disabled>Choose Driver</option>
                                    
                                </select>
                            </div>
                        
                            <!-- Show when "Carrier" is selected -->
                            <div x-show="formData.delivery_type === 'Carrier'" class="isTruc mt-4">
                                <label class="block text-gray-700 dark:text-gray-300">Assign Carrier</label>
                                <select x-model="formData.carrier_id" name="carrier_id"
                                    class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="carrier_id">
                                    <option value="" selected disabled>Choose Carrier</option>
                                    <!-- <option value="1">John Doe</option>
                                    <option value="2">Billy John</option>
                                    <option value="3">Jane Doe</option> -->
                                </select>
                            </div>

                             <!-- Show when "Bike" is selected -->
                             <!-- <div x-show="formData.delivery_type === 'Bike'" class="isBike mt-4">
                                <label class="block text-gray-700 dark:text-gray-300">Assign Bike</label>
                                <select x-model="formData.bike_id" name="bike_id"
                                    class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" id="bike_driver">
                                    <option value="" selected disabled>Choose Bike</option>
                                    <option value="1">John Doe</option>
                                    <option value="2">Billy John</option>
                                    <option value="3">Jane Doe</option>
                                </select>
                            </div> -->
                        
                        </div>
                        
                    </div>

                    <!-- Step 4: Backup Docs -->
                    <div x-show="step === 4" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <template x-for="(upload, index) in formData.shipment_uploads" :key="index">
                            <h3 class="font-medium text-gray-900 dark:text-gray-100">Document #<span x-text="index + 1"></span></h3>
                            <img :src="`https://laravel-production-077b.up.railway.app/storage/${upload.file_path}`" class="w-32 h-32 object-cover rounded-md" alt="Document Image" />
                        </template>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">Attach files</label>
                            <input type="file" multiple name="file_path[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="Enter charge amount" id="file_path">
                        </div>
                    </div>

                 <!-- Step 5: Expenses -->
                    <div x-show="step === 5" class="space-y-6">
                        <template x-for="(expense, index) in formData.shipment_expenses" :key="index">
                            <div class="p-4 border rounded-lg bg-white dark:bg-gray-800 shadow-sm dark:border-gray-700 mb-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h3 class="font-medium text-gray-900 dark:text-gray-100">Expense #<span x-text="index + 1"></span></h3>
                                    <button @click="removeExpense(index)" type="button" 
                                            class="text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 text-sm">
                                        Remove
                                    </button>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-4">
                                    <!-- Expense Type -->
                                    <div>
                                        <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">Expense Type</label>
                                        <select x-model="expense.expense_type" name="expense_type[]"
                                                class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:ring-blue-500 focus:border-blue-500">
                                       
                                                <option value="chasis_rental">Chasis Rental</option>
                                                <option value="detention">Detention</option>
                                                <option value="fuel_cost">Fuel Cost</option>
                                                <option value="misc_vendor_bills">Misc Vendor Bills</option>
                                                <option value="perdiem_bills">Perdiem Bilss</option>
                                                <option value="shop_repair_cost">Shop and Repair Cost</option>
                                                <option value="toll">Toll</option>
                                                <option value="pickup">Pickup</option>
                                                <option value="pickup">Pickup</option>
                                                <option value="pickup">Pickup</option>
                                                <option value="pickup">Pickup</option>
                                                <option value="pickup">Pickup</option>
                                        </select>
                                    </div>

                                    <!-- Units -->
                                    <div>
                                        <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">Units</label>
                                        <input type="text" x-model="expense.expense_unit" name="expense_unit[]"
                                            @change="calculateExpenseAmount(index)"
                                            class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:ring-blue-500 focus:border-blue-500">
                                    </div>

                                    <!-- Rate -->
                                    <div>
                                        <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">Rate</label>
                                        <input type="text" x-model="expense.expense_rate" name="expense_rate[]"
                                            @change="calculateExpenseAmount(index)"
                                            class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:ring-blue-500 focus:border-blue-500">
                                    </div>

                                    <!-- Amount -->
                                    <div>
                                        <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">Amount</label>
                                        <input type="text" x-model="expense.expense_amount" name="expense_amount[]" readonly
                                            class="w-full p-2 border rounded dark:bg-gray-600 dark:border-gray-500 dark:text-white bg-gray-100">
                                    </div>

                                    <!-- Credit/Reim Amount -->
                                    <div>
                                        <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">Credit/Reim Amount</label>
                                        <input type="text" x-model="expense.credit_reimbursement_amount" name="credit_reimbursement_amount[]"
                                            class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:ring-blue-500 focus:border-blue-500">
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                                    <!-- Vendor Invoice # -->
                                    <div>
                                        <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">Vendor Invoice #</label>
                                        <input type="text" x-model="expense.vendor_invoice_number" name="vendor_invoice_number[]"
                                            class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:ring-blue-500 focus:border-blue-500">
                                    </div>

                                    <!-- Payment Reference Note -->
                                    <div>
                                        <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">Payment Reference Note</label>
                                        <textarea x-model="expense.payment_reference_note" name="payment_reference_note[]"
                                                class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:ring-blue-500 focus:border-blue-500"></textarea>
                                    </div>

                                    <!-- Disputed Note -->
                                    <div x-show="expense.expense_disputed">
                                        <label class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-300">Disputed Note</label>
                                        <textarea x-model="expense.disputed_note" name="disputed_note[]"
                                                class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:ring-blue-500 focus:border-blue-500"></textarea>
                                    </div>

                                    <!-- Disputed Checkbox -->
                                        <div class="flex items-center">
                                            <input type="hidden" :name="`expense_disputed[${index}]`" :value="expense.expense_disputed ? '1' : '0'">
                                            <label class="flex items-center text-gray-700 dark:text-gray-300">
                                                <input type="checkbox" x-model="expense.expense_disputed" 
                                                    @change="expense.expense_disputed = $event.target.checked"
                                                    class="rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700 text-blue-600 focus:ring-blue-500">
                                                <span class="ml-2 text-sm">Disputed?</span>
                                            </label>
                                        </div>

                                        <!-- Paid Checkbox -->
                                        <div class="flex items-center">
                                            <input type="hidden" :name="`paid[${index}]`" :value="expense.paid ? '1' : '0'">
                                            <label class="flex items-center text-gray-700 dark:text-gray-300">
                                                <input type="checkbox" x-model="expense.paid" 
                                                    @change="expense.paid = $event.target.checked"
                                                    class="rounded border-gray-300 dark:border-gray-600 dark:bg-gray-700 text-blue-600 focus:ring-blue-500">
                                                <span class="ml-2 text-sm">Paid?</span>
                                            </label>
                                    </div>
                                </div>
                            </div>
                        </template>

                        <!-- Add Expense Button -->
                        <button @click="addExpense" type="button"
                                class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded dark:bg-blue-700 dark:hover:bg-blue-800 transition-colors">
                            + Add New Expense
                        </button>
                    </div>
            
                    <!-- Navigation Buttons -->
                    <div class="flex justify-between mt-6">
                        <button type="button" class="px-4 py-2 bg-gray-300 text-gray-700 rounded dark:bg-gray-600 dark:text-white"
                            x-show="step > 1" @click="prevStep">
                            Previous
                        </button>
                        <button type="button" class="px-4 py-2 bg-blue-600 text-white rounded dark:bg-blue-500"
                            x-show="step < 5" @click="nextStep">
                            Next
                        </button>
                        <button type="button" class="px-4 py-2 bg-yellow-500 text-white rounded dark:bg-yellow-400"
                            @click="saveProgress">
                            Save & Continue Later
                        </button>
                        <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded dark:bg-green-500"
                            x-show="step === 5">
                            Submit
                        </button>
                    </div>
                </form>
            </div>
            
        </div>
    </div>
          </div>
        </main>
        <!-- ===== Main Content End ===== -->
      </div>
      <!-- ===== Content Area End ===== -->
    </div>
    <!-- ===== Page Wrapper End ===== -->

    <script>
         populateCarrierSelect() 
function populateCarrierSelect() {
      $.ajax({
          url: requestGetURL + '/carriers/carriers',
          type: 'GET',
          headers: {
              'Authorization': 'Bearer ' + localStorage.getItem('auth_token'),
              'Accept': 'application/json'
          },
          success: (response) => {
              console.log('Carrier data:', response.carriers);
              if(response.carriers.length == 0){
                  //createToast('error', 'No customer found.');
                  return
              }
              if (Array.isArray(response.carriers)) {
                  var carrierselect = document.getElementById('carrier_id');
                  var preCarrierselect = document.getElementById('pre_carrier');
                  var CarrierNameselect = document.getElementById('carrier_name');

                  carrierselect.innerHTML = '';
                  preCarrierselect.innerHTML = '';
                  CarrierNameselect.innerHTML = '';

                  var defaultOption = document.createElement('option');
                  defaultOption.value = '';
                  defaultOption.text = 'Carrier';
                  //defaultOption.disabled = true;
                  defaultOption.hidden = true;
                  carrierselect.appendChild(defaultOption);

                  var defaultPreOption = document.createElement('option');
                  defaultPreOption.value = '';
                  defaultPreOption.text = 'Carrier';
                  //defaultOption.disabled = true;
                  defaultPreOption.hidden = true;
                  preCarrierselect.appendChild(defaultPreOption);

                //   carrien name
                  var defaultCarrierNameOption = document.createElement('option');
                  defaultCarrierNameOption.value = '';
                  defaultCarrierNameOption.text = 'Carrier';
                  //defaultOption.disabled = true;
                  defaultCarrierNameOption.hidden = true;
                  CarrierNameselect.appendChild(defaultCarrierNameOption);
  
                  response.carriers.forEach(carrier => {
                      var option = document.createElement('option');
                      option.value = carrier.id;
                      option.text = carrier.name;
                      carrierselect.appendChild(option);

                    //   pre carried
                    var preoption = document.createElement('option');
                    preoption.value = carrier.id;
                    preoption.text = carrier.name;
                    preCarrierselect.appendChild(preoption);

                    //   carrier name
                    var carrierNameoption = document.createElement('option');
                    carrierNameoption.value = carrier.id;
                    carrierNameoption.text = carrier.name;
                    CarrierNameselect.appendChild(carrierNameoption);

                  });
              } else {
                  console.error('Invalid response format:', response);
                  createToast('error', 'Invalid customer data received.');
              }
          },
          error: (xhr, status, error) => {
              console.error('API request failed:', xhr.responseText);
  
              if (xhr.status === 401) {
                  alert("Session expired. Please log in again.");
                  localStorage.removeItem('auth_token');
                  window.location.href = "/signin";
              } else {
                  try {
                      let response = JSON.parse(xhr.responseText);
                      let message = response.message || "An error occurred. Please try again.";
                      createToast('error', message);
                  } catch (e) {
                      createToast("error", "An unexpected error occurred.");
                  }
              }
          }
      });
  }

        
var requestURL = "https://laravel-production-077b.up.railway.app/api/v1";
document.addEventListener('alpine:init', () => {
    Alpine.data('stepperForm', () => ({
    step: localStorage.getItem('edit_load') ? parseInt(localStorage.getItem('edit_load')) : 1,

        //isLoading: false,
        formData: {
            office: '',
                  load_type: '',
                  load_type_note: '',
                  load_type_note_r: '',
                  isBroker: '',
                  shipment_type: '',
                  bill_to: '',
                  quick_note: '',
                  container: '',
                  container_size: '',
                  container_type: '',
                  chasis: '',
                  isLoaded: '',
                  chasis_size: '',
                  chasis_type: '',
                  chasis_vendor: '',
                  reference_number: '',
                  booking_number: '',
                  bill_of_laden_number: '',
                  po_number: '',
                  load_weight: '',
                  commodity: '',
                  pieces: '',
                  pick_up_number: '',
                  over_weight: [],
                  tags: [],
                  tagsInput: '',
                  genset_number: '',
                  seal_number: '',
                  pick_up: '',
                  look_up: '',
                  pick_up_location_name: '',
                  pick_up_address:'',
                  pick_up_address: '',
                  pick_up_city: '',
                  zip: '',
                  appt_date: '',
                  from: '',
                  to: '',
                  no_latter_than_date: '',
                  drop_at_no_latter_than_time: '',
                  broker_name: '',
                  broker_email: '',
                  broker_number: '',
                  reefer_temp: '',
                  broker_reference_number: '',
                  batch_number: '',
                  batch_req: '',
                  sales_rep: '',
                  edi_number: '',
                  note: '',

                   //miles
                   total_miles:'',
                  loaded_miles:'',
                  empty_miles:'',
                  dh_miles:'',
                  fuel_rate_per_gallon:'',
                  mpg:'',
                  fuel_cototal_fuel_costst:'',



                  charge_type: '',
                  comment: '',
                  units: '',
                  rate: '',
                  amount: '',
                  discount: '',
                  internal_notes: '',
                  total: '',
                  total_discount: '',
                  net_total: '',
                  delivery_type: '',
                  driver_id: '',
                  carrier_id: '',
                  shipment_type: '',
                    shipper_name: '',
                    ocean_shipper_address: '',
                    ocean_shipper_reference_number: '',
                    carrier_name: '',
                    carrier_reference_number: '',
                    ocean_bill_of_ladening_number: '',
                    consignee: '',
                    consignee_phone: '',
                    consignee_email: '',
                    first_notify_party_name: '',
                    first_notify_party_phone: '',
                    first_notify_party_email: '',
                    second_notify_party_name: '',
                    second_notify_party_phone: '',
                    second_notify_party_email: '',
                    pre_carrier: '',
                    port_of_discharge: '',
                    vessel_aircraft_name: '',
                    voyage_number: '',
                    port_of_discharge: '',
                    place_of_delivery: '',
                    final_destination: '',
                    port_of_landing: '',
                    ocean_note: '',
                    ocean_freight_charges: '',
                    ocean_total_containers_in_words: '',
                    no_original_bill_of_landing: '',
                    original_bill_of_landing_payable_at: '',
                    ocean_freight_charges: '',
                    shipped_on_board_date: '',
                    goods_name: '',
                    ocean_vin: '',
                    ocean_weight: '',
                    shipment_charges: [],
                    shipment_expenses: [],
                    shipment_uploads: [],
        },
        step: 1,

        init() {
            //this.fetchData();
            const urlParams = new URLSearchParams(window.location.search);
            const encodedId = urlParams.get('id');
            if (encodedId) {
                this.id = atob(encodedId);
                this.fetchData();
            } else {
                console.error('No ID found in the URL');
            }
        },
        
        addTag() {
                if (this.formData.tagsInput.trim()) {
                    // Split by spaces and filter out empty strings
                    const newTags = this.formData.tagsInput.split(' ')
                    .map(tag => tag.trim())
                    .filter(tag => tag.length > 0);
                    
                    // Add new tags to the array, avoiding duplicates
                    newTags.forEach(tag => {
                    if (!this.formData.tags.includes(tag)) {
                        this.formData.tags.push(tag);
                    }
                    });
                    
                    this.formData.tagsInput = '';
                    //this.saveProgress();
                }
                },
                
                removeTag(index) {
                this.formData.tags.splice(index, 1);
                //this.saveProgress();
                },
                
                removeLastTag() {
                if (this.formData.tagsInput === '' && this.formData.tags.length > 0) {
                    this.formData.tags.pop();
                    //this.saveProgress();
                }
                },

                fetchData() {
                    fetch(`${requestGetURL}/shipments/show/${this.id}`, {
                        headers: {
                            'Authorization': 'Bearer ' + localStorage.getItem('auth_token'),
                            'Accept': 'application/json'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        this.formData = {
                            ...this.formData,
                            ...data,
                            shipment_type: data.shipment_type || '',
                            over_weight: data.over_weight || [],
                            tags: data.tags || [],
                            
                            // Initialize charges with proper numeric values
                            shipment_charges: data.shipment_charges?.map(charge => ({
                                id: charge.id || '',
                                charge_type: charge.type || '',
                                comment: charge.comment || '',
                                units: charge.unit ? parseFloat(charge.unit) : 0,
                                rate: charge.rate ? parseFloat(charge.rate) : 0,
                                amount: charge.amount ? parseFloat(charge.amount) : 0,
                                discount: charge.discount ? parseFloat(charge.discount) : 0,
                                internal_notes: charge.internal_notes || '',
                                billed: charge.billed || false,
                                invoice_date: charge.invoice_date || '',
                                invoice_number: charge.invoice_number || ''
                            })) || [],
                            
                            // Initialize expenses with proper numeric values
                            shipment_expenses: data.shipment_expenses?.map(expense => ({
                                id: expense.id || '',
                                expense_type: expense.expense_type || '',
                                expense_unit: expense.units ? parseFloat(expense.units) : 0,
                                expense_rate: expense.rate ? parseFloat(expense.rate) : 0,
                                expense_amount: expense.amount ? parseFloat(expense.amount) : 0,
                                disputed_amount: expense.disputed_amount ? parseFloat(expense.disputed_amount) : 0,
                                expense_billed: expense.billed || false,
                                credit_reimbursement_amount: expense.credit_reimbursement_amount ? parseFloat(expense.credit_reimbursement_amount) : 0,
                                vendor_invoice_number: expense.vendor_invoice_number || '',
                                payment_reference_note: expense.payment_reference_note || '',
                                disputed_note: expense.disputed_note || '',
                                expense_disputed: expense.billed || false,
                                vendor_invoice_name: expense.vendor_invoice_name || '',
                                paid: expense.paid || false
                            })) || [],
                            
                            // Other data
                            shipment_notes: data.shipment_notes?.map(notes => ({
                                id: notes.id || '',
                                note: notes.note || '',
                            })) || [],
                            
                            shipment_uploads: data.shipment_uploads?.map(upload => ({
                                id: upload.id || '',
                                file_name: upload.file_name || '',
                                file_path: upload.file_path || '',
                            })) || [],
                        };
                        
                        // Calculate initial totals
                        this.calculateChargeTotals();
                        this.calculateExpenseTotals();
                    })
                    .catch(error => {
                        console.error('Error fetching data:', error);
                    });
                },

        // fetchData() {
        //     //this.isLoading = true;
        //     fetch(`${requestGetURL}/shipments/show/${this.id}`, {
        //         headers: {
        //             'Authorization': 'Bearer ' + localStorage.getItem('auth_token'),
        //             'Accept': 'application/json'
        //         }
        //     })
        //         .then(response => response.json())
        //         .then(data => {
        //             console.log('Fetched Data:', data);
        //             localStorage.setItem('Fetched Data: ', data)
        //             this.formData = {
        //             ...this.formData,
        //             ...data,
        //             shipment_type: data.shipment_type || '',
        //             over_weight: data.over_weight || [],
        //             tags: data.tags || [],
        //             shipment_charges: data.shipment_charges?.map(charge => ({
        //                 id: charge.id || '',
        //                 charge_type: charge.type || '',
        //                 comment: charge.comment || '',
        //                 units: charge.unit || '',
        //                 rate: charge.rate || '',
        //                 amount: charge.amount || '',
        //                 discount: charge.discount || '',
        //                 internal_notes: charge.internal_notes || '',
        //                 billed: charge.billed || false,
        //                 invoice_date: charge.invoice_date || '',
        //                 invoice_number: charge.invoice_number || ''
        //             })) || [],

        //             //expenses
        //             shipment_expenses: data.shipment_expenses?.map(expense => ({
        //                 id: expense.id || '',
        //                 expense_type: expense.expense_type || '',
        //                 expense_unit: expense.units || '',
        //                 expense_rate: expense.rate || '',
        //                 expense_amount: expense.amount || '',
        //                 expense_amount: expense.disputed_amount || '',
        //                 expense_billed: expense.billed || '',
        //                 credit_reimbursement_amount: expense.credit_reimbursement_amount || '',
        //                 vendor_invoice_number: expense.vendor_invoice_number || '',
        //                 payment_reference_note: expense.payment_reference_note || '',
        //                 disputed_note: expense.disputed_note || '',
        //                 expense_disputed: expense.expense_disputed || false,
        //                 vendor_invoice_number: expense.vendor_invoice_number,
        //                 vendor_invoice_name: expense.vendor_invoice_name,
        //                 paid: expense.paid || false
        //             })) || [],

        //             //notes
        //             shipment_notes: data.shipment_notes?.map(notes => ({
        //                 id: notes.id || '',
        //                 note: notes.note || '',
        //             })) || [],

        //             //docs
        //             shipment_uploads: data.shipment_uploads?.map(upload => ({
        //                 id: upload.id || '',
        //                 file_name: upload.file_name || '',
        //                 file_path: upload.file_path || '',
        //             })) || [],
        //         };
        //         })
                
        //         .catch(error => {
        //             console.error('Error fetching data:', error);
        //         })
                
        //     .finally(() => {
        //         //this.isLoading = false;
        //     });
        // },

      

        // Charge Management Methods
        addCharge() {
            this.formData.shipment_charges.push({
                id: '',
                charge_type: '',
                comment: '',
                units: 0,
                rate: 0,
                amount: 0,
                discount: 0,
                internal_notes: '',
                billed: false,
                invoice_date: '',
                invoice_number: ''
            });
        },

        removeCharge(index) {
            this.formData.shipment_charges.splice(index, 1);
            this.calculateChargeTotals();
        },

        calculateChargeAmount(index) {
            const charge = this.formData.shipment_charges[index];
            const units = parseFloat(charge.units) || 0;
            const rate = parseFloat(charge.rate) || 0;
            charge.amount = (units * rate).toFixed(2);
            this.calculateChargeTotals();
        },

        calculateChargeTotals() {
            const totals = this.formData.shipment_charges.reduce((acc, charge) => {
                acc.total += parseFloat(charge.amount) || 0;
                acc.discount += parseFloat(charge.discount) || 0;
                return acc;
            }, { total: 0, discount: 0 });

            // Update the formData with the calculated totals
            this.formData.total = totals.total.toFixed(2);
            this.formData.total_discount = totals.discount.toFixed(2);
            this.formData.net_total = (totals.total - totals.discount).toFixed(2);
        },

        // For Shipment Expenses
        addExpense() {
            this.formData.shipment_expenses.push({
                id: '',
                expense_type: '',
                expense_unit: 0,
                expense_rate: 0,
                expense_amount: 0,
                disputed_amount: 0,
                expense_billed: false,
                credit_reimbursement_amount: 0,
                vendor_invoice_number: '',
                payment_reference_note: '',
                disputed_note: '',
                expense_disputed: false,
                vendor_invoice_name: '',
                paid: false
            });
        },

        removeExpense(index) {
            this.formData.shipment_expenses.splice(index, 1);
            this.calculateExpenseTotals();
        },

        calculateExpenseAmount(index) {
            const expense = this.formData.shipment_expenses[index];
            const units = parseFloat(expense.expense_unit) || 0;
            const rate = parseFloat(expense.expense_rate) || 0;
            expense.expense_amount = (units * rate).toFixed(2);
            this.calculateExpenseTotals();
        },

        calculateExpenseTotals() {
            const totals = this.formData.shipment_expenses.reduce((acc, expense) => {
                acc.total += parseFloat(expense.expense_amount) || 0;
                acc.credit += parseFloat(expense.credit_reimbursement_amount) || 0;
                return acc;
            }, { total: 0, credit: 0 });

            this.formData.expenses_total = totals.total.toFixed(2);
            this.formData.expenses_credit = totals.credit.toFixed(2);
            this.formData.expenses_net_total = (totals.total - totals.credit).toFixed(2);
        },

        calculateExpenseTotals() {
            // Implement if you need expense-specific totals
        },

        nextStep() {
                  this.step++;
                  localStorage.setItem('edit_load', this.step);
              },
              prevStep() {
                  this.step--;
                  localStorage.setItem('edit_load', this.step);
              },

      

        saveProgress() {
            localStorage.setItem('formData', JSON.stringify(this.formData));
            alert("Progress saved successfully!");
        },

        saveAndSubmit(e) {
            console.log('Form Data:', this.formData);
               // console.log("ID is",this.id)
                // return;
                var requestURL = "https://laravel-production-077b.up.railway.app/api/v1";
                  localStorage.removeItem('formData');
                  localStorage.removeItem('step');
                  e.preventDefault();
                  var shipment_type = document.getElementById("shipment_type").value

                    let form = document.getElementById("editloadForm");
                    let formData = new FormData(form);
                    formData.append('tags', this.formData.tags.join(','));
                    // console.log('id is', this.id)
                    // return
                    // Ensure expenses are included
                    // this.formData.shipment_expenses.forEach((expense, index) => {
                    //     formData.append(`shipment_expenses[${index}][expense_type]`, expense.expense_type);
                    //     formData.append(`shipment_expenses[${index}][expense_unit]`, expense.expense_unit);
                    //     formData.append(`shipment_expenses[${index}][expense_rate]`, expense.expense_rate);
                    //     formData.append(`shipment_expenses[${index}][expense_amount]`, expense.expense_amount);
                    //     formData.append(`shipment_expenses[${index}][credit_reimbursement_amount]`, expense.credit_reimbursement_amount);
                    //     formData.append(`shipment_expenses[${index}][vendor_invoice_number]`, expense.vendor_invoice_number);
                    //     formData.append(`shipment_expenses[${index}][payment_reference_note]`, expense.payment_reference_note);
                    //     formData.append(`shipment_expenses[${index}][disputed_note]`, expense.disputed_note);
                    //     formData.append(`shipment_expenses[${index}][expense_disputed]`, expense.expense_disputed ? 1 : 0);
                    //     formData.append(`shipment_expenses[${index}][paid]`, expense.paid ? 1 : 0);
                    // });

                    // this.formData.shipment_charges.forEach((charge, index) => {
                    //     formData.append(`shipment_charges[${index}][charge_type]`, charge.charge_type);
                    //     formData.append(`shipment_charges[${index}][comment]`, charge.comment);
                    //     formData.append(`shipment_charges[${index}][units]`, charge.units);
                    //     formData.append(`shipment_charges[${index}][rate]`, charge.rate);
                    //     formData.append(`shipment_charges[${index}][amount]`, charge.amount);
                    //     formData.append(`shipment_charges[${index}][discount]`, charge.discount);
                    //     formData.append(`shipment_charges[${index}][internal_notes]`, charge.internal_notes);
                    //     formData.append(`shipment_charges[${index}][billed]`, charge.billed ? 1 : 0);  // Convert checkbox boolean to 1/0
                    // });


          
                    let fileInput = document.getElementById("file_path");
                    if (fileInput.files.length > 0) {
                        for (let i = 0; i < fileInput.files.length; i++) {
                            formData.append(`shipment_uploads[${i}]`, fileInput.files[i]);
                        }
                    }
                    

                    for (let pair of formData.entries()) {
                        console.log(pair[0] + ": " + pair[1]);
                    }
                    //return
                    formData.append("_method", "PUT");
                    $.ajax({
                        url: requestURL+'/shipments/update/'+this.id,
                        type: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        headers: {
                            'Authorization': 'Bearer ' + localStorage.getItem('auth_token'),
                            'Accept': 'application/json'
                        },

                        beforeSend:function(){
                            document.getElementById("Ajaxbackdrop").style.display = 'flex'
                        },

                        success: (response) => {
                            document.getElementById("Ajaxbackdrop").style.display = 'none'
                            //console.log('Form submitted successfully:', response);
                            createToast('success', response.message);
                            localStorage.removeItem('formData');
                            localStorage.removeItem('step');
                        },
                         error: (xhr, status, error) => {
                        console.error('Form submission failed:', xhr.responseText);
                            document.getElementById("Ajaxbackdrop").style.display = 'none'

                        try {
                            let response = JSON.parse(xhr.responseText);
                            
                            if (response.errors) {
                                let messages = Object.values(response.errors).flat().join('<br>'); // Combines multiple errors
                                createToast('error', messages);
                            } else if (response.message) {
                                createToast('error', response.message);
                            } else {
                                createToast('error', 'An unexpected error occurred. Please try again.');
                            }
                        } catch (e) {
                            createToast('error', 'An error occurred. Please check your input and try again.', + e);
                        }
                    }
                });
             }
        }));
    });

        //populate driver select
    populateDriverSelect();




      function handleLoadTypeChange(value) {
    if (value === 'import') {
        console.log(`Load type changed to ${value}`);
        // You can add specific logic for import/export here
        // For example, show/hide specific form sections
        document.getElementById('container').style.display = '';
        // Example: Show a message or change UI elements
        //alert(`Selected load type: ${value}`);
        
        // You could show/hide specific form sections
        // document.getElementById('importSection').style.display = value === 'import' ? 'block' : 'none';
        // document.getElementById('exportSection').style.display = value === 'export' ? 'block' : 'none';
    }
    
    // Trigger auto-save when selection changes
    //handleInputChange();
}
      </script>
      <script>
        function duplicateContainer() {
            var container = document.getElementById("container");
            var containerList = document.getElementById("containerList");
    
            // Clone container and remove display:none
            var newContainer = container.cloneNode(true);
            newContainer.style.display = "block";
    
            // Append new container
            containerList.appendChild(newContainer);
        }

        function removeContainer(element) {
            element.parentElement.parentElement.remove();
        }

        function duplicateBillto()
        {
            var billto = document.getElementById("billto");
            var billtoList = document.getElementById("billtoList");
            var newBillto = billto.cloneNode(true);
            billtoList.appendChild(newBillto);
        }

        function removeBillto(element)
        {
            element.parentElement.parentElement.remove();
        }
        //

        function duplicatePickup()
        {
            var pickup = document.getElementById("pickUPP");
            var pickupList = document.getElementById("pickupList");
            var newPickup = pickup.cloneNode(true);
            pickupList.appendChild(newPickup);
        }
        function removePickup(element)
        {
            element.parentElement.parentElement.remove();
        }

        
        function duplicateDropAt()
        {
            var pickup = document.getElementById("dropAt");
            var pickupList = document.getElementById("dropAtList");
            var newPickup = pickup.cloneNode(true);
            pickupList.appendChild(newPickup);
        }
        function removeDropAt(element)
        {
            element.parentElement.parentElement.remove();
        }

        function duplicateCharges()
        {
            var pickup = document.getElementById("chargesDuplicate");
            var pickupList = document.getElementById("chargesList");
            var newPickup = pickup.cloneNode(true);
            pickupList.appendChild(newPickup);
        }
        function removeCharges(element)
        {
            element.parentElement.parentElement.remove();
        }

    //     function duplicateGoods() {
    //     var pickup = document.getElementById("chargesDuplicate");
    //     var pickupList = document.getElementById("goodsList");
    //     var newPickup = pickup.cloneNode(true);

    //     // Ensure the cloned element has a unique ID to avoid duplicates
    //     newPickup.id = "chargesDuplicate_" + Date.now();

    //     // Append the cloned element
    //     pickupList.appendChild(newPickup);
    // }

    // function removeGoods(element) {
    //     var item = element.closest(".charges-item");
    //     if (item) {
    //         item.remove();
    //     }
    // }

        

        
function handleShipmentType() {
    var shipmentType = document.getElementById("shipment_type").value;
    //alert("Selected Shipment Type: " + shipmentType);

    if(shipmentType === "air")
    {
        $.ajax({
            url: 'api/airports.php',
            type: 'GET',
            beforeSend:function()
            {
                
            },
            success: function(response) {
                var airportList = document.getElementById("airportList");
                airportList.innerHTML = '';
            },
            error: function(xhr, status, error) {
                console.log(error);
            }
        });
    }
}

    </script>
      
  <script src="./assets/js/newload.js"></script>
  <include src="./partials/footer.html"></include>