<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Invoice | smileslogistics</title>

    <include src="./partials/mainhead.html"> </include>
    <script src="./assets/js/main.js"></script>
  </head>
  <body
    x-data="{ page: 'invoice', 'loaded': true, 'darkMode': false, 'stickyMenu': false, 'sidebarToggle': false, 'scrollTop': false }"
    x-init="
         darkMode = JSON.parse(localStorage.getItem('darkMode'));
         $watch('darkMode', value => localStorage.setItem('darkMode', JSON.stringify(value)))"
    :class="{'dark bg-gray-900': darkMode === true}"
  >
    <!-- ===== Preloader Start ===== -->
    <include src="./partials/preloader.html"></include>
    <!-- ===== Preloader End ===== -->

    <!-- ===== Page Wrapper Start ===== -->
    <div class="flex h-screen overflow-hidden">
      <!-- ===== Sidebar Start ===== -->
      <include src="./partials/sidebar.html"></include>
      <!-- ===== Sidebar End ===== -->

      <!-- ===== Content Area Start ===== -->
      <div
        class="relative flex flex-1 flex-col overflow-y-auto overflow-x-hidden"
      >
        <!-- Small Device Overlay Start -->
        <include src="./partials/overlay.html" />
        <!-- Small Device Overlay End -->

        <!-- ===== Header Start ===== -->
        <include src="./partials/header.html" />
        <!-- ===== Header End ===== -->

        <!-- ===== Main Content Start ===== -->
        <main>
          <div class="mx-auto max-w-screen-2xl p-4 md:p-6">
            <!-- Breadcrumb Start -->
            <div x-data="{ pageName: `Invoice`}">
              <include src="./partials/breadcrumb.html" />
            </div>
            <!-- Breadcrumb End -->

            <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]">
              <div x-data="stepperForm()" class="w-full mx-auto px-4">
                <ol class="flex items-center justify-between w-full p-3 text-sm font-medium text-center text-gray-500 bg-white border border-gray-200 rounded-lg shadow-xs dark:text-gray-400 sm:text-base dark:bg-gray-800 dark:border-gray-700 sm:p-4 rtl:space-x-reverse">
                    <!-- Step 1 -->
                    <li class="flex-1 flex items-center justify-center"
                        :class="{ 'text-blue-600 dark:text-blue-500': step === 1, 'text-gray-500 dark:text-gray-400': step !== 1 }">
                        <span class="flex items-center justify-center w-6 h-6 text-xs font-bold border rounded-full"
                            :class="{ 'border-blue-600 bg-blue-600 text-white dark:border-blue-500': step === 1, 'border-gray-500 dark:border-gray-400': step !== 1 }">
                            1
                        </span>
                        <span class="ml-2 hidden sm:inline">Basic Info</span>
                    </li>
                
                    <!-- Step 2 -->
                    <li class="flex-1 flex items-center justify-center"
                        :class="{ 'text-blue-600 dark:text-blue-500': step === 2, 'text-gray-500 dark:text-gray-400': step !== 2 }">
                        <span class="flex items-center justify-center w-6 h-6 text-xs font-bold border rounded-full"
                            :class="{ 'border-blue-600 bg-blue-600 text-white dark:border-blue-500': step === 2, 'border-gray-500 dark:border-gray-400': step !== 2 }">
                            2
                        </span>
                        <span class="ml-2 hidden sm:inline">Recieve Payments</span>
                    </li>
                
                    <!-- Step 3 -->
                    <li class="flex-1 flex items-center justify-center"
                        :class="{ 'text-blue-600 dark:text-blue-500': step === 3, 'text-gray-500 dark:text-gray-400': step !== 3 }">
                        <span class="flex items-center justify-center w-6 h-6 text-xs font-bold border rounded-full"
                            :class="{ 'border-blue-600 bg-blue-600 text-white dark:border-blue-500': step === 3, 'border-gray-500 dark:border-gray-400': step !== 3 }">
                            3
                        </span>
                        <span class="ml-2 hidden sm:inline">Backup Docs</span>
                    </li>
                </ol>
                
                
            
                <form class="mt-6 bg-white p-6 rounded-lg shadow dark:bg-gray-800 w-full border border-gray-200 dark:border-gray-700" @submit.prevent="saveAndSubmit" enctype="multipart/form-data" id="newInvoice">
                    <!-- Step 1: Basic Info -->
                    <div x-show="step === 1">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-6">
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300">Invoice Type</label>
                                <select x-model="formData.invoice_type" name="invoice_type" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option value="" selected disabled>Select Type</option>
                                    <option value="standard invoive">Standard Invoice</option>
                                    <option value="debit invoice">Debit Invoice</option>
                                    <option value="credit memo">Credit Memo</option>
                                </select>
                            </div>
                            <!-- <div>
                                <label class="block text-gray-700 dark:text-gray-300">Truck Office</label>
                                <select x-model="formData.truck_office" name="truck_office" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                    <option value="" selected disabled>Select Office</option>
                                    <option value="IN">IN</option>
                                </select>
                            </div> -->
                            <!-- <div>
                                <label class="block text-gray-700 dark:text-gray-300">Invoice Number</label>
                                <input type="text" x-model="formData.invoice_number" name="invoice_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                            </div> -->
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300">Invoice Date</label>
                                <input type="text" x-model="formData.invoice_date" id="invoice_datepicker" name="invoice_date" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">Is Factored?</label>
                            <label for="invoice_number" class="flex">
                                <input type="checkbox" x-model="formData.isFactored" 
                                       name="isFactored"
                                       class="w-2 p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"
                                       :value="true">
                                <span class="flex text-gray-700 dark:text-gray-300">Yes, is Factored</span>
                            </label>
                        </div>
                        
                    </div>
                
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-6">
                        <!-- <div>
                            <label class="block text-gray-700 dark:text-gray-300">Invoice Prefix</label>
                            <select x-model="formData.invoice_prefix" name="invoice_prefix" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="" selected disabled>Select </option>
                                <option value="owner_operator">Owner Operator Truck</option>
                            </select>
                        </div> -->
                       
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">Override Default Company</label>
                            <input type="text" x-model="formData.override_default_company" name="override_default_company" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>

                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">Bill to</label>
                            <select x-model="formData.customer_id" name="customer_id" id="customer_id" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">

                            </select>
                        </div>
                    </div>

                    <!-- <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-6">
                       
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">Bill to</label>
                            <textarea type="text" x-model="formData.bill" cols="1" rows="1" name="" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"> </textarea>
                        </div>
                    </div> -->

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-6">
                        <!-- <div>
                            <label class="block text-gray-700 dark:text-gray-300">Invoice Terms</label>
                            <select x-model="formData.invoice_terms" name="invoice_terms" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="" selected disabled>Select </option>
                            </select>
                        </div> -->
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">Invoice Due Date</label>
                            <input type="text" x-model="formData.invoice_due_date" id="invoice_due_datepicker" name="invoice_due_date" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">Attention Invoice</label>
                            <input type="text" x-model="formData.attention_invoice_to" name="attention_invoice_to" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">Bill to Party</label>
                            <textarea type="text" cols="1" rows="1" x-model="formData.note_bill_to_party" name="note_bill_to_party" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"> </textarea>
                        </div>
                    </div>
                    

                    <div class="grid grid-cols-1 md:grid-cols-5 gap-3 mb-6">
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">Loads on Invoice</label>
                            <input type="text" x-model="formData.loads_on_invoice" id="loads_on_invoice" name="loads_on_invoice" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">Booking #</label>
                            <input type="text" x-model="formData.booking_number" id="booking_number" name="booking_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">BOL #</label>
                            <input type="text" x-model="formData.bill_of_landing_number" name="bill_of_landing_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">PO #</label>
                            <input type="text" x-model="formData.po_number" name="po_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">Reference #</label>
                            <input type="text" x-model="formData.reference_number" name="reference_number" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-4 gap-3 mb-6">
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">Move Date</label>
                            <input type="text" x-model="formData.move_date" id="move_date_datepicker" name="move_date" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">Trailer</label>
                            <input type="text" x-model="formData.trailer" id="trailer" name="trailer" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">Container</label>
                            <input type="text" x-model="formData.container" name="container" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">Chasis</label>
                            <input type="text" x-model="formData.chasis" name="chasis" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                    </div>

                    

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-6">
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">Load Weight</label>
                            <input type="text" x-model="formData.load_weight" id="load_weight" name="load_weight" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">Commodity</label>
                            <input type="text" x-model="formData.commodity" id="commodity" name="commodity" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">No of Packages</label>
                            <input type="text" x-model="formData.no_of_packages" name="no_of_packages" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-2">
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">From</label>
                            <input type="text" x-model="formData.from_address" id="" name="from_address" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">To</label>
                            <input type="text" x-model="formData.to_address" id="to_address" name="to_address" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">Other Stops</label>
                            <input type="text" x-model="formData.stop_address" name="stop_address" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-6">
                        <div>
                            <textarea type="text" x-model="formData.load_weight" id="load_weight" name="load_weight" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"> </textarea>
                        </div>
                        <div>
                            <textarea type="text" x-model="formData.commodity" id="commodity" name="commodity" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"> </textarea>
                        </div>
                        <div>
                            <textarea type="text" x-model="formData.no_of_packages" name="no_of_packages" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white"> </textarea>
                        </div>
                    </div>

                        <div>
                            <h4 class="mb-1 text-sm font-medium text-gray-800 dark:text-white/90">Charges</h4>
                            <template x-for="(charge, index) in formData.charges" :key="index">
                                <div class="mb-6">
                                    <div class="flex justify-end mb-2">
                                        <span @click="addCharge()" 
                                              class="ml-2 cursor-pointer text-lg font-bold text-blue-600 dark:text-blue-400">
                                            +
                                        </span>
                                        <span @click="removeCharge(index)" 
                                              class="ml-2 cursor-pointer text-lg font-bold text-blue-600 dark:text-red-500">
                                            x
                                        </span>
                                    </div>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6 chargecalc">
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Charge Type</label>
                                            <select x-model="charge.charge_type" name="charge_type[]" 
                                                    class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                                <option value="" selected disabled></option>
                                                <option value="Drayage">Drayage</option>
                                                <option value="Fuel Surcharge">Fuel Surcharge</option>
                                                <option value="admin_fee">Admin Fee</option>
                                                <option value="attempted_pickup">Attempted Pickup</option>
                                                <option value="bonded_cargo_charge">Bonded cargo charge</option>
                                                <option value="chasis_rental">Chasis Rental</option>
                                                <option value="chasis_split">Chasis Split</option>
                                                <option value="chasis_stack">Chasis Stack</option>
                                                <option value="demurage">Demurage</option>
                                                <option value="driver_assistance">Driver Assistance</option>
                                                <option value="drop_charge">Drop Charge</option>
                                                <option value="dry\">Dry run</option>
                                                <option value="freight">Frieght</option>
                                                <option value="hauling_refrigerated_cargo">Hauling Refrigenerated Cargo</option>
                                                <option value="harzadous_material">Hazardous Material</option>
                                                <option value="maintainave_and_repair">Maintainance and Repair</option>
                                                <option value="other">Other</option>
                                                <option value="over_weight">Over Weight</option>
                                                <option value="per_diem">Per Diem</option>
                                                <option value="permits">Permit</option>
                                                <option value="pre_pull">Pre Pull</option>
                                                <option value="re_delivery_charge">Re Delivery Charge</option>
                                                <option value="shipping">Shipping</option>
                                                <option value="scale_load">Scale Load</option>
                                                <option value="spot_empty">Spot Empty</option>
                                                <option value="stop_off">Stop Off</option>
                                                <option value="storage">Storage</option>
                                                <option value="toll">Toll</option>
                                                <option value="triaxle">Trixle</option>
                                                <!-- Other options... -->
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Comment</label>
                                            <input type="text" x-model="charge.comment" name="comment[]" 
                                                   class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Units</label>
                                            <input type="number" x-model="charge.units" 
                                                   @input="calculateAmount(charge)" name="units[]" 
                                                   class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Rate</label>
                                            <input type="number" x-model="charge.rate" 
                                                   @input="calculateAmount(charge)" name="rate[]" 
                                                   class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                        </div>
                                    </div>
                    
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Amount</label>
                                            <input type="number" x-model="charge.amount" name="amount[]" 
                                                   readonly class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Discount</label>
                                            <input type="number" x-model="charge.discount" 
                                                   @input="calculateTotals()" name="discount[]" 
                                                   class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 dark:text-gray-300">Internal Note</label>
                                            <input type="text" x-model="charge.internal_notes" name="internal_notes[]" 
                                                   class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                        </div>
                                    </div>
                                </div>
                            </template>
                    
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300">Total</label>
                                    <input type="number" x-model="formData.total" name="total" 
                                           readonly class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300">Total Discount</label>
                                    <input type="number" x-model="formData.total_discount" name="total_discount" 
                                           readonly class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                </div>
                                <div>
                                    <label class="block text-gray-700 dark:text-gray-300">Net Total</label>
                                    <input type="number" x-model="formData.net_total" name="net_total" 
                                           readonly class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    
                    <!-- Step 2: Backup Docs -->
                    <div x-show="step === 2">
                       <div>
                           <label class="block text-gray-700 dark:text-gray-300">Attach files</label>
                           <div id="RecieveRepay">
                                <span onclick="duplicateRecieve()" 
                                    class="ml-2 cursor-pointer text-lg font-bold text-blue-600 dark:text-blue-400">
                                    +
                                </span>
                                <span onclick="removeRecieve(this)" 
                                    class="ml-2 cursor-pointer text-lg font-bold text-blue-600 dark:text-red-500">
                                    x
                                    <!-- 🗑 -->
                                </span>
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Credit Memo</label>
                                        <input type="text" x-model="formData.credit_memo" name="credit_memo[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Credit Amount</label>
                                        <input type="text" x-model="formData.credit_amount" name="credit_amount[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white numberOnly" placeholder="">
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Note</label>
                                        <textarea type="text" cols="1" rows="1" x-model="formData.credit_note" name="credit_note[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder=""> </textarea>
                                    </div>
                                    <div>
                                        <label class="block text-gray-700 dark:text-gray-300">Date</label>
                                        <input type="text" x-model="formData.credit_date" id="credit_date" name="credit_date[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="">
                                    </div>
                                </div>
                           </div>
                           <div id="RecieveRepayList"></div>

                           

                           <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300">Balance Before Credit</label>
                                <input type="text" x-model="formData.balance_before_credit" name="balance_before_credit[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white" placeholder="" readonly>
                            </div>
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300">Total Credit Applied</label>
                                <input type="text" x-model="formData.total_credit_applied" name="total_credit_applied[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white numberOnly" placeholder="">
                            </div>
                            <div>
                                <label class="block text-gray-700 dark:text-gray-300">Final Invoice Bal</label>
                                <input type="text" x-model="formData.final_invoice_bal" name="final_invoice_bal[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white numberOnly" placeholder="">
                            </div>
                        </div>
                       </div>
                    </div>
                
                    <!-- Step 3: Review & Submit -->
                    <div x-show="step === 3">
                        <div>
                            <label class="block text-gray-700 dark:text-gray-300">Attach files</label>
                            <input type="file" x-model="formData.file" multiple name="file[]" class="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                        </div>
                    </div>
                
                    <!-- Navigation Buttons -->
                    <div class="flex justify-between mt-6">
                        <!-- Previous Button -->
                        <button type="button" class="px-4 py-2 bg-gray-300 text-gray-700 rounded dark:bg-gray-600 dark:text-white"
                            x-show="step > 1" @click="prevStep">
                            Previous
                        </button>
                
                        <!-- Next Button -->
                        <button type="button" class="px-4 py-2 bg-blue-600 text-white rounded dark:bg-blue-500"
                            x-show="step < 3" @click="nextStep">
                            Next
                        </button>
                
                        <!-- Save & Continue Later -->
                        <button type="button" class="px-4 py-2 bg-yellow-500 text-white rounded dark:bg-yellow-400"
                            @click="saveProgress">
                            Save & Continue Later
                        </button>
                
                        <!-- Submit Button (Only shows on Step 3) -->
                        <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded dark:bg-green-500"
                            x-show="step === 3">
                            Submit
                        </button>
                    </div>

                </form>
            </div>
            </div>

          </div>
        </main>
        <!-- ===== Main Content End ===== -->
      </div>
      <!-- ===== Content Area End ===== -->
    </div>
    <!-- ===== Page Wrapper End ===== -->

    <script>


function stepperForm() {
    return {
        step: localStorage.getItem('Invoice_step') ? parseInt(localStorage.getItem('Invoice_step')) : 1,
        formData: (() => {
            const savedData = localStorage.getItem('formData');
            const defaultData = {
                invoice_type: '',
                invoice_date: '',
                isFactored: '',
                override_default_company: '',
                customer_id: '',
                invoice_due_date: '',
                attention_invoice_to: '',
                note_bill_to_party: '',	
                loads_on_invoice: '',
                booking_number: '',
                bill_of_landing_number: '',
                po_number: '',
                reference_number: '',
                move_date: '',
                trailer: '',
                container: '',
                chasis: '',
                load_weight: '',
                commodity: '',
                no_of_packages: '',
                
                // Initialize charges array
                charges: [{
                    charge_type: '',
                    comment: '',
                    units: '',
                    rate: '',
                    amount: '',
                    discount: '',
                    internal_notes: ''
                }],
                total: 0,
                total_discount: 0,
                net_total: 0,
                
                credit_memo: [],
                credit_amount: [],
                credit_note: [],
                credit_date: [],
                balance_before_credit: [],
                total_credit_applied: [],
                final_invoice_bal: []
            };
            
            return savedData ? {...defaultData, ...JSON.parse(savedData)} : defaultData;
        })(),
        
        totalSteps: 3,
        
        init() {
            // Initialize charges calculations
            if (!this.formData.charges || this.formData.charges.length === 0) {
                this.formData.charges = [{
                    charge_type: '',
                    comment: '',
                    units: '',
                    rate: '',
                    amount: '',
                    discount: '',
                    internal_notes: ''
                }];
            }
            this.calculateTotals();
            this.$watch('formData.charges', () => this.calculateTotals(), { deep: true });
        },
        
        nextStep() {
            if (this.step < this.totalSteps) {
                this.step++;
                this.saveProgress();
            }
        },
        
        prevStep() {
            if (this.step > 1) {
                this.step--;
                this.saveProgress();
            }
        },
        
        saveProgress() {
            localStorage.setItem('Invoice_step', this.step);
            localStorage.setItem('formData', JSON.stringify(this.formData));
        },
        
        // Charge calculation methods
        addCharge() {
            this.formData.charges.push({
                charge_type: '',
                comment: '',
                units: '',
                rate: '',
                amount: '',
                discount: '',
                internal_notes: ''
            });
            this.saveProgress();
        },
        
        removeCharge(index) {
            if (this.formData.charges.length > 1) {
                this.formData.charges.splice(index, 1);
                this.calculateTotals();
                this.saveProgress();
            }
        },
        
        calculateAmount(charge) {
            const units = parseFloat(charge.units) || 0;
            const rate = parseFloat(charge.rate) || 0;
            charge.amount = (units * rate).toFixed(2);
            this.calculateTotals();
            this.saveProgress();
        },
        
        calculateTotals() {
            let total = 0;
            let totalDiscount = 0;
            
            this.formData.charges.forEach(charge => {
                const amount = parseFloat(charge.amount) || 0;
                const discount = parseFloat(charge.discount) || 0;
                
                total += amount;
                totalDiscount += discount;
            });
            
            this.formData.total = total.toFixed(2);
            this.formData.total_discount = totalDiscount.toFixed(2);
            this.formData.net_total = (total - totalDiscount).toFixed(2);
        },
        
        saveAndSubmit() {
            let form = document.getElementById("newInvoice");
            let formData = new FormData(form);
            formData.append('file', this.formData.file);
            
            // Convert charges array to form data
            this.formData.charges.forEach((charge, index) => {
                formData.append(`charges[${index}][charge_type]`, charge.charge_type);
                formData.append(`charges[${index}][comment]`, charge.comment);
                formData.append(`charges[${index}][units]`, charge.units);
                formData.append(`charges[${index}][rate]`, charge.rate);
                formData.append(`charges[${index}][amount]`, charge.amount);
                formData.append(`charges[${index}][discount]`, charge.discount);
                formData.append(`charges[${index}][internal_notes]`, charge.internal_notes);
            });
            
            // Add totals
            formData.append('total', this.formData.total);
            formData.append('total_discount', this.formData.total_discount);
            formData.append('net_total', this.formData.net_total);

            $.ajax({
                url: requestURL+'/invoices/create',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('auth_token'),
                    'Accept': 'application/json'
                },
                beforeSend: function() {
                    document.getElementById("Ajaxbackdrop").style.display = 'flex'
                },
                success: (response) => {
                    document.getElementById("Ajaxbackdrop").style.display = 'none'
                    createToast('success', response.message);
                    localStorage.removeItem('formData');
                    localStorage.removeItem('Invoice_step');
                },
                error: (xhr, status, error) => {
                    document.getElementById("Ajaxbackdrop").style.display = 'none'
                    console.error('Form submission failed:', xhr.responseText);
                    try {
                        let response = JSON.parse(xhr.responseText);
                        if (response.errors) {
                            let messages = Object.values(response.errors).flat().join('<br>');
                            createToast('error', messages);
                        } else if (response.message) {
                            createToast('error', response.message);
                        } else {
                            createToast('error', response.error || 'An unexpected error occurred. Please try again.');
                        }
                    } catch (e) {
                        createToast('error', 'An error occurred. Please check your input and try again.');
                    }
                }
            });

            // Clear stored data after submission
            localStorage.removeItem('formData');
            localStorage.removeItem('Invoice_step');
            
            // Reset form data
            this.formData = {
                // Your initial form data structure
                invoice_type: '',
                // ... other fields ...
                charges: [{
                    charge_type: '',
                    comment: '',
                    units: '',
                    rate: '',
                    amount: '',
                    discount: '',
                    internal_notes: ''
                }],
                total: 0,
                total_discount: 0,
                net_total: 0
            };
            this.step = 1;
        }
    };
}










            function stepperFm() {
            return {
                step: localStorage.getItem('Invoice_step') ? parseInt(localStorage.getItem('Invoice_step')) : 1,
                formData: JSON.parse(localStorage.getItem('formData')) || {
                    invoice_type: '',
                    invoice_date: '',
                    isFactored: '',
                    override_default_company: '',
                    customer_id: '',
                    invoice_due_date: '',
                    attention_invoice_to: '',
                    note_bill_to_party: '',	
                    loads_on_invoice: '',
                    booking_number: '',
                    bill_of_landing_number: '',
                    po_number: '',
                    reference_number: '',
                    move_date: '',
                    trailer: '',
                    container: '',
                    chasis: '',
                    load_weight: '',
                    commodity: '',
                    no_of_packages: '',
                    charge_type: [],
                    comment: [],
                    units: [],
                    rate: [],
                    amount: [],
                    discount: [],
                    internal_notes: [],
                    total: '',
                    total_discount: '',
                    net_total: '',
                    credit_memo: [],
                    credit_amount: [],
                    credit_note: [],
                    credit_date: [],
                    balance_before_credit: [],
                    total_credit_applied: [],
                    final_invoice_bal: [],

                    charges: [{
                    charge_type: '',
                    comment: '',
                    units: '',
                    rate: '',
                    amount: '',
                    discount: '',
                    internal_notes: ''
                }],
                total: 0,
                total_discount: 0,
                net_total: 0
                },
                totalSteps: 3, // Adjust based on actual number of steps
                nextStep() {
                    if (this.step < this.totalSteps) {
                        this.step++;
                        this.saveProgress();
                    }
                },
                prevStep() {
                    if (this.step > 1) {
                        this.step--;
                        this.saveProgress();
                    }
                },
                saveProgress() {
                    localStorage.setItem('Invoice_step', this.step);
                    localStorage.setItem('formData', JSON.stringify(this.formData));
                },
                
                saveAndSubmit() {
                    //alert("Form submitted successfully!");
                    let form = document.getElementById("newInvoice");
                    let formData = new FormData(form);
                    formData.append('file', this.formData.file);
                      // console.log("FormData Contents:");
                    for (let pair of formData.entries()) {
                        console.log(pair[0] + ": " + pair[1]);
                    }
                          console.log(localStorage.getItem('auth_token'))
                     //return

                    $.ajax({
                        url: requestURL+'/invoices/create',
                        type: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        headers: {
                            'Authorization': 'Bearer ' + localStorage.getItem('auth_token'),
                            'Accept': 'application/json'
                        },

                        beforeSend:function(){
                            document.getElementById("Ajaxbackdrop").style.display = 'flex'
                        },

                        success: (response) => {
                            document.getElementById("Ajaxbackdrop").style.display = 'none'
                            //console.log('Form submitted successfully:', response);
                            createToast('success', response.message);
                            localStorage.removeItem('formData');
                            localStorage.removeItem('step');
                        },
                         error: (xhr, status, error) => {
                            document.getElementById("Ajaxbackdrop").style.display = 'none'
                            console.error('Form submission failed:', xhr.responseText);

                        try {
                            let response = JSON.parse(xhr.responseText);
                            
                            if (response.errors) {
                                let messages = Object.values(response.errors).flat().join('<br>');
                                createToast('error', messages);
                            } else if (response.message) {
                                createToast('error', response.message);
                            } else {
                                createToast('error',  response.error || 'An unexpected error occurred. Please try again.');
                            }
                        } catch (e) {
                            createToast('error', 'An error occurred. Please check your input and try again.');
                        }
                    }
                });

                    // Clear stored data after submission
                    localStorage.removeItem('formData');
                    localStorage.removeItem('Invoice_step');

                    // Reset form data
                    this.formData = {
                        invoice_type: '',
                        email: '',
                        phone: '',
                        charge_amount: '',
                        charge_type: '',
                        currency: '',
                    };
                    this.step = 1;
                }
            }
        }


        
                        $(function() {
                            $("#move_date_datepicker").datepicker({
                                
                            });
                        });

                        $(function() {
                            $("#invoice_due_datepicker").datepicker({
                                
                            });
                        });

                        $(function() {
                            $("#invoice_datepicker, #credit_date").datepicker({
                                
                            });
                        });
              
                    function calculate() {
                    let units = parseFloat($("#unit").val()) || 0;
                    let rate = parseFloat($("#rate").val()) || 0;
                    let discount = parseFloat($("#discount").val()) || 0;

                    let total = units * rate;
                    let netTotal = total - discount;
                    console.log("Net total is",netTotal)

                    $("#amount").val(total);
                    $("#total").val(total);
                    $("#net_total").val(netTotal);
                    $("#total_discount").val(discount);
                }

                    $(".calc-field").on("input", function() {
                        calculate();
                    });

                    calculate();



      function handleLoadTypeChange(value) {
        if (value === 'import') {
            console.log(`Load type changed to ${value}`);
            // You can add specific logic for import/export here
            // For example, show/hide specific form sections
            document.getElementById('container').style.display = '';
            // Example: Show a message or change UI elements
            //alert(`Selected load type: ${value}`);
            
            // You could show/hide specific form sections
            // document.getElementById('importSection').style.display = value === 'import' ? 'block' : 'none';
            // document.getElementById('exportSection').style.display = value === 'export' ? 'block' : 'none';
        }
        
        // Trigger auto-save when selection changes
        //handleInputChange();
    }



      </script>
      <script>
        function duplicateContainer() {
            var container = document.getElementById("container");
            var containerList = document.getElementById("containerList");
    
            // Clone container and remove display:none
            var newContainer = container.cloneNode(true);
            newContainer.style.display = "block";
    
            // Append new container
            containerList.appendChild(newContainer);
        }

        function removeContainer(element) {
            element.parentElement.parentElement.remove();
        }

        function duplicateBillto()
        {
            var billto = document.getElementById("billto");
            var billtoList = document.getElementById("billtoList");
            var newBillto = billto.cloneNode(true);
            billtoList.appendChild(newBillto);
        }

        function removeBillto(element)
        {
            element.parentElement.parentElement.remove();
        }
        //

        function duplicatePickup()
        {
            var pickup = document.getElementById("pickUPP");
            var pickupList = document.getElementById("pickupList");
            var newPickup = pickup.cloneNode(true);
            pickupList.appendChild(newPickup);
        }
        function removePickup(element)
        {
            element.parentElement.parentElement.remove();
        }

        
        function duplicateDropAt()
        {
            var pickup = document.getElementById("dropAt");
            var pickupList = document.getElementById("dropAtList");
            var newPickup = pickup.cloneNode(true);
            pickupList.appendChild(newPickup);
        }
        function removeDropAt(element)
        {
            element.parentElement.parentElement.remove();
        }

        function duplicateCharges()
        {
            var pickup = document.getElementById("chargesDuplicate");
            var pickupList = document.getElementById("chargesList");
            var newPickup = pickup.cloneNode(true);
            pickupList.appendChild(newPickup);
        }
        function removeCharges(element)
        {
            element.parentElement.parentElement.remove();
        }

        function duplicateRecieve()
        {
            var pickup = document.getElementById("RecieveRepay");
            var pickupList = document.getElementById("RecieveRepayList");
            var newPickup = pickup.cloneNode(true);
            pickupList.appendChild(newPickup);
        }
        function removeRecieve(element)
        {
            element.parentElement.parentElement.remove();
        }

        populateCustomerSelect();
    </script>
      
  </body>
</html>
