<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Pricing |</title>
    <include src="./partials/mainhead.html"> </include>
    <script src="./assets/js/main.js"></script>
  </head>
  <body
    x-data="{ page: 'pricing', 'loaded': true, 'darkMode': false, 'stickyMenu': false, 'sidebarToggle': false, 'scrollTop': false }"
    x-init="
         darkMode = JSON.parse(localStorage.getItem('darkMode'));
         $watch('darkMode', value => localStorage.setItem('darkMode', JSON.stringify(value)))"
    :class="{'dark bg-gray-900': darkMode === true}"
  >
    <!-- ===== Preloader Start ===== -->
    <include src="./partials/preloader.html"></include>
    <!-- ===== Preloader End ===== -->

    <!-- ===== Page Wrapper Start ===== -->
    <div class="flex h-screen overflow-hidden">
      <!-- ===== Sidebar Start ===== -->
      <include src="./partials/sidebar.html"></include>
      <!-- ===== Sidebar End ===== -->

      <!-- ===== Content Area Start ===== -->
      <div
        class="relative flex flex-1 flex-col overflow-y-auto overflow-x-hidden"
      >
        <!-- Small Device Overlay Start -->
        <include src="./partials/overlay.html" />
        <!-- Small Device Overlay End -->

        <!-- ===== Header Start ===== -->
        <include src="./partials/header.html" />
        <!-- ===== Header End ===== -->

        <!-- ===== Main Content Start ===== -->
        <main>
          <div x-data="datatable" class="mx-auto max-w-screen-2xl p-4 md:p-6">
            <!-- Breadcrumb Start -->
            <div x-data="{ pageName: `Pricing`}">
              <include src="./partials/breadcrumb.html" />
            </div>
            <!-- Breadcrumb End -->

            <div
              class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"
            >
              

            <section class="bg-white dark:bg-gray-900">
              <div class="py-8 px-4 mx-auto max-w-screen-xl lg:py-16 lg:px-6">
                  <div class="mx-auto max-w-screen-md text-center mb-8 lg:mb-12">
                      <h2 class="mb-4 text-4xl tracking-tight font-extrabold text-gray-900 dark:text-white">Designed for business teams like yours</h2>
                      <p class="mb-5 font-light text-gray-500 sm:text-xl dark:text-gray-400">Lorem ipsum dolor sit amet consectetur adipisicing elit. Eaque, ipsum. Reiciendis omnis quo corrupti quod velit deleniti ipsum neque sequi?</p>
                  </div>
                  <div class="space-y-8 lg:grid lg:grid-cols-3 sm:gap-6 xl:gap-10 lg:space-y-0">
                    <!-- Loop through each plan -->
                    <template x-for="(plan, index) in items" :key="index">
                      <div class="flex flex-col p-6 mx-auto max-w-lg text-center text-gray-900 bg-white rounded-lg border border-gray-100 shadow dark:border-gray-600 xl:p-8 dark:bg-gray-800 dark:text-white">
                        <h3 class="mb-4 text-2xl font-semibold" x-text="plan.name"></h3>
                        <p class="font-light text-gray-500 sm:text-lg dark:text-gray-400" x-text="plan.description"></p>
                        
                        <div class="flex justify-center items-baseline my-8">
                          <span class="mr-2 text-5xl font-extrabold" x-text="'$' + plan.price"></span>
                          <span class="text-gray-500 dark:text-gray-400">/month</span>
                        </div>
                        
                        <!-- Features List -->
                        <ul role="list" class="mb-8 space-y-4 text-left">
                          <template x-for="(feature, featureIndex) in JSON.parse(plan.features || '[]')" :key="featureIndex">
                            <li class="flex items-center space-x-3">
                              <svg class="flex-shrink-0 w-5 h-5 text-green-500 dark:text-green-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                              </svg>
                              <span x-text="feature"></span>
                            </li>
                          </template>
                        </ul>
                        
                        <a href="#" class="text-white bg-primary-600 hover:bg-primary-700 focus:ring-4 focus:ring-primary-200 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:text-white dark:focus:ring-primary-900">
                          Get started
                        </a>
                      </div>
                    </template>
                  </div>
              </div>
            </section>
            </div>

          </div>
        </main>
        <!-- ===== Main Content End ===== -->
      </div>
      <!-- ===== Content Area End ===== -->
    </div>
    <!-- ===== Page Wrapper End ===== -->

    <script>
      document.addEventListener('alpine:init', () => {
        Alpine.data('datatable', () => ({
            items: [],
            searchQuery: '',
            isLoading: false,

            get filteredItems() {
                if (!this.searchQuery) return this.items;

                const query = this.searchQuery.toLowerCase();

                return this.items.filter(item => {
                    return (
                        item.load_number.toString().toLowerCase().includes(query) ||
                        (item.truck_drivers.user.fname + ' ' + (item.truck_drivers.user.mname || '') + ' ' + item.truck_drivers.user.lname).toLowerCase().includes(query) ||
                        item.user.email.toLowerCase().includes(query) ||
                        item.phone.toLowerCase().includes(query) ||
                        item.company.toLowerCase().includes(query) ||
                        item.load_type.toLowerCase().includes(query) ||
                        item.booking_number.toLowerCase().includes(query) ||
                        item.from.toLowerCase().includes(query) ||
                        item.to.toLowerCase().includes(query) ||
                        item.return.toLowerCase().includes(query) ||
                        item.port_appt.toLowerCase().includes(query) ||
                        item.cust_appt.toLowerCase().includes(query) ||
                        item.stop_list.toLowerCase().includes(query) ||
                        item.pickup_number.toLowerCase().includes(query) ||
                        item.bol_number.toLowerCase().includes(query) ||
                        item.po_number.toLowerCase().includes(query) ||
                        item.lfd.toLowerCase().includes(query) ||
                        item.status.toLowerCase().includes(query)
                    );
                });
            },

            init() {
                this.fetchData();
            },

            fetchData() {
                this.isLoading = true;
                fetch(requestGetURL + '/plans/plans', {
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem('auth_token'),
                        'Accept': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Plans data:', data.plans);
                    if (data.plans && Array.isArray(data.plans)) {
                        this.items = data.plans.map(plan => {
                            // Ensure features exists and is parsed
                            return {
                                ...plan,
                                features: plan.features || '[]' // Default to empty array if null
                            };
                        });
                    } else {
                        console.error('Invalid data format:', data);
                    }
                })
                    .catch(error => {
                        console.error('Error fetching data:', error);
                        if (error.status === 401) {
                            alert("Session expired. Please log in again.");
                            localStorage.removeItem('auth_token');
                            window.location.href = "/signin.html";
                        }
                    })
                    .finally(() => {
                        this.isLoading = false;
                    });
            },

            // Edit item
            editItem(id) {
              const encodedId = btoa(id);
                window.location.href = `/edit_carrier.html?id=${encodedId}`;
            },

            // View item
            viewItem(id) {
              const encodedId = btoa(id);
              window.location.href = `/view_carrier_single.html?id=${encodedId}`;
            },

            // Delete item
            deleteItem(id) {
                if (confirm('Are you sure you want to delete this item?')) {
                    fetch(`${requestGetURL}/carriers/delete/${id}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': 'Bearer ' + localStorage.getItem('auth_token'),
                            'Accept': 'application/json'
                        }
                    })
                        .then(response => {
                            if (response.ok) {
                              createToast('success', 'Carrier deleted succesfully');
                                //alert('Item deleted successfully');
                                this.fetchData(); 
                            } else {
                                //alert('Failed to delete item');
                                createToast('error', 'Failed to delete Item');
                            }
                        })
                        .catch(error => {
                            console.error('Error deleting item:', error);
                        });
                }
            }
        }));
    });
    </script>
  </body>
</html>
