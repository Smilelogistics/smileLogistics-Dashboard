<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <include src="./partials/mainhead.html"> </include>
    <script src="./assets/js/main.js"></script>
    <title>Loads | </title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
@media print {
  body {
    -webkit-print-color-adjust: exact !important; /* Force background colors */
    print-color-adjust: exact !important;
  }

  /* Hide buttons or elements with the class "no-print" */
  .no-print {
    display: none !important;
  }

  /* Ensure Tailwind colors and dark mode still appear */
  html {
    color-scheme: light dark;
  }

  /* Optional: Make sure tables don't break */
  table {
    border-collapse: collapse !important;
    page-break-inside: avoid !important;
  }

  /* Optional: Maintain spacing & rounding */
  .rounded-lg, .rounded-xl {
    border-radius: 0.75rem !important;
  }

  .shadow-md, .shadow-lg {
    box-shadow: none !important; /* Or adjust if you prefer */
  }
}
</style>

  </head>
  <body
    x-data="{ page: 'view_loads', 'loaded': true, 'darkMode': false, 'stickyMenu': false, 'sidebarToggle': false, 'scrollTop': false }"
    x-init="
         darkMode = JSON.parse(localStorage.getItem('darkMode'));
         $watch('darkMode', value => localStorage.setItem('darkMode', JSON.stringify(value)))"
    :class="{'dark bg-gray-900': darkMode === true}"
  >
    <!-- ===== Preloader Start ===== -->
    <include src="./partials/preloader.html"></include>
    <!-- ===== Preloader End ===== -->

    <!-- ===== Page Wrapper Start ===== -->
    <div class="flex h-screen overflow-hidden">
      <!-- ===== Sidebar Start ===== -->
      <include src="./partials/sidebar.html"></include>
      <!-- ===== Sidebar End ===== -->

      <!-- ===== Content Area Start ===== -->
      <div class="relative flex flex-1 flex-col overflow-y-auto overflow-x-hidden">
        <!-- Small Device Overlay Start -->
        <include src="./partials/overlay.html" />
        <!-- Small Device Overlay End -->

        <!-- ===== Header Start ===== -->
        <include src="./partials/header.html" />
        <!-- ===== Header End ===== -->

        <!-- ===== Main Content Start ===== -->
        <main>
          <div class="mx-auto max-w-screen-2xl p-4 md:p-6">
            <!-- Breadcrumb Start -->
            <div x-data="{ pageName: `View Loads`}">
              <include src="./partials/breadcrumb.html" />
            </div>
            <!-- Breadcrumb End -->
             
            <div class="w-full">
              <div class="space-y-12">
                <div class="rounded-2xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03] p-2">
                  <div class="px-5 py-4 sm:px-6 sm:py-5">
                    <h3 class="text-base font-medium text-gray-800 dark:text-white/90">
                      All Loads
                    </h3>
                  </div>
          
                  <!-- Inputs Container -->
                  <div class="border-t border-gray-100 p-5 dark:border-gray-800 sm:p-6">
                    <div class="overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]">
                      <div class="max-w-full overflow-x-auto">
                        <div class="max-w-6xl mx-auto" x-data="singleItem">
                          <!-- Loading State -->
                          <template x-if="isLoading">
                            <div class="text-center py-8">
                              <div class="inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-blue-500"></div>
                              <p class="mt-2 text-gray-600">Loading shipment details...</p>
                            </div>
                          </template>
                        
                          <!-- Main Card -->
                          <div id="printableArea1" class="bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden border border-gray-200 dark:border-gray-700" x-show="!isLoading && formData">
                            <!-- Header -->
                             <div id="printableArea">
                            
                            <!-- Content -->
                            <div class="p-2" >
                              <div >
                                <template x-if="formData.shipment_type === 'land'">
                                  <div class="flex justify-between items-start mb-6">
                                    <!-- Left Side -->
                                    <div class="flex-1">
                                        <!-- Logo -->
                                        <div class="flex items-center gap-3 mb-8">
                                            <div class="w-[70px] h-[70px] rounded-xl flex items-center justify-center">
                                                 <div>
                                                  <img :src="formData.invoice_logo_url" alt="Logo"  class="w-36 h-36 object-contain"
                                                                    >
                                                  </div>
                                            </div>
                                            <!-- <div>
                                                <div class="text-[28px] font-bold text-blue-700 dark:text-blue-400 leading-none">SMILES</div>
                                                <div class="text-[11px] font-bold text-blue-700 dark:text-blue-400 tracking-wide">LOGISTICS GROUP</div>
                                            </div> -->
                                        </div>

                                        <!-- Info Lines -->
                                        <div class="space-y-[2px] text-[13px]">
                                            <div class="dark:text-gray-200"><span class="font-semibold">Shipment Type:</span> <span x-text="formData.shipment_type"></span></div>
                                            <div class="dark:text-gray-200"><span class="font-semibold">Date:</span> <span x-text="formData.created_at"></span></div>
                                            <div class="dark:text-gray-200"><span class="font-semibold">Office:</span> <span x-text="formData.office"></span></div>
                                            <div class="dark:text-gray-200"><span class="font-semibold">Bill To:</span> <span x-text="formData.bill_to"></span></div>
                                            <div class="dark:text-gray-200"><span class="font-semibold">Sales Rep:</span> <span x-text="formData.broker_sales_rep"></span></div>
                                            <div class="dark:text-gray-200"><span class="font-semibold">Driver:</span> <span x-text="formData.driver ? formData.driver : 'N/A'"></span></div>
                                        </div>

                                        <!-- Commodity Info -->
                                        <div class="mt-5 text-[13px] dark:text-gray-200">
                                            <span class="font-semibold">Commodity:</span> <span x-text="formData.commodity ? formData.commodity : 'N/A'"></span> &nbsp;&nbsp;&nbsp;&nbsp;
                                            <span class="font-semibold">Load Weight:</span> <span x-text="formData.load_weight ? formData.load_weight : 'N/A'"></span> &nbsp;&nbsp;&nbsp;&nbsp;
                                            <span class="font-semibold">Pieces:</span> <span x-text="formData.pieces ? formData.pieces : 'N/A'"></span> &nbsp;&nbsp;&nbsp;&nbsp;
                                            <span class="font-semibold">Reefer Temp:</span> <span x-text="formData.reefer_temp || 'N/A'"></span>&nbsp;&nbsp;&nbsp;&nbsp;
                                            <span class="font-semibold">Broker Name:</span> <span x-text="formData.broker_name || 'N/A'"></span>&nbsp;&nbsp;&nbsp;&nbsp;
                                            <span class="font-semibold">Broker Email:</span> <span x-text="formData.broker_email || 'N/A'"></span>&nbsp;&nbsp;&nbsp;&nbsp;
                                            <span class="font-semibold">Broker Phone Number:</span> <span x-text="formData.broker_phone || 'N/A'"></span>
                                        </div>
                                    </div>

                                    <!-- Right Side -->
                                    <div class="text-right ml-8">
                                        <h1 class="text-[22px] font-bold mb-6 dark:text-white">LAND SHIPMENT DETAILS</h1>
                                        <div class="space-y-[2px] text-[13px]">
                                            <div class="flex justify-between gap-12">
                                                <span class="font-semibold dark:text-gray-200">Reference #:</span>
                                                <span class="dark:text-gray-200" x-text="formData.reference_number || 'N/A'"></span>
                                            </div>
                                            <div class="flex justify-between gap-12">
                                                <span class="font-semibold dark:text-gray-200">Booking #:</span>
                                                <span class="dark:text-gray-200" x-text="formData.booking_number || 'N/A'"></span>
                                            </div>
                                            <div class="flex justify-between gap-12">
                                                <span class="font-semibold dark:text-gray-200">BOL #:</span>
                                                <span class="dark:text-gray-200" x-text="formData.bill_of_laden_number || 'N/A'"></span>
                                            </div>
                                            <div class="flex justify-between gap-12">
                                                <span class="font-semibold dark:text-gray-200">PO #:</span>
                                                <span class="dark:text-gray-200" x-text="formData.po_number || 'N/A'"></span>
                                            </div>
                                            <div class="flex justify-between gap-12">
                                                <span class="font-semibold dark:text-gray-200">Batch #:</span>
                                                <span class="dark:text-gray-200" x-text="formData.batch_number || 'N/A'"></span>
                                            </div>
                                            <div class="flex justify-between gap-12">
                                                <span class="font-semibold dark:text-gray-200">Genset #:</span>
                                                <span class="dark:text-gray-200" x-text="formData.genset_number || 'N/A'"></span>
                                            </div>
                                            <div class="flex justify-between gap-12">
                                                <span class="font-semibold dark:text-gray-200">Seal #:</span>
                                                <span class="dark:text-gray-200" x-text="formData.seal_number || 'N/A'"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                              </template>

                                <!-- Pickup Address -->
                                <div class="mb-6">
                                  <h2 class="text-[16px] font-bold mb-3 dark:text-white">Pickup Address</h2>
                                  <!-- Check if pickups exist -->
                                  <template x-if="Array.isArray(formData.pickups) && formData.pickups.length > 0">
                                    <table class="w-full text-[12px] border-collapse">
                                      <thead>
                                        <tr class="bg-blue-900 dark:bg-blue-800 text-white">
                                          <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Type</th>
                                          <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Location Name</th>
                                          <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Address</th>
                                          <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">City</th>
                                          <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Zip</th>
                                          <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">State</th>
                                          <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Appointment Date</th>
                                          <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Not Later Than</th>
                                          <th class="px-3 py-2 text-left font-semibold">Not Later Time</th>
                                        </tr>
                                      </thead>

                                      <tbody class="dark:text-gray-200">
                                        <template x-for="(pickup, index) in formData.pickups" :key="index">
                                          <tr class="border-b border-gray-300 dark:border-gray-700">
                                            <td class="px-3 py-2" x-text="pickup.pick_up_type || 'N/A'"></td>
                                            <td class="px-3 py-2" x-text="pickup.location_name || 'N/A'"></td>
                                            <td class="px-3 py-2" x-text="pickup.address || 'N/A'"></td>
                                            <td class="px-3 py-2" x-text="pickup.city || 'N/A'"></td>
                                            <td class="px-3 py-2" x-text="pickup.zip || 'N/A'"></td>
                                            <td class="px-3 py-2" x-text="pickup.state || 'N/A'"></td>
                                            <td class="px-3 py-2" x-text="pickup.appt_date ? new Date(pickup.appt_date).toLocaleDateString() : ''"></td>
                                            <td class="px-3 py-2" x-text="pickup.no_latter_than_date ? new Date(pickup.no_latter_than_date).toLocaleDateString() : ''"></td>
                                            <td class="px-3 py-2" x-text="pickup.no_latter_than_time ? new Date('1970-01-01T' + pickup.no_latter_than_time).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : ''"></td>
                                          </tr>
                                        </template>
                                      </tbody>
                                    </table>
                                  </template>

                                  <!-- Message when no pickups found -->
                                  <template x-if="!formData.pickups || formData.pickups.length === 0">
                                    <div class="p-4 text-center text-sm text-gray-600 dark:text-gray-300 bg-gray-50 dark:bg-gray-800 rounded-md">
                                      ðŸšš No pickups found.
                                    </div>
                                  </template>
                                </div>


                                 <div class="mb-6">
                                  <h2 class="text-[16px] font-bold mb-3 dark:text-white">Dropoff Address</h2>

                                  <template x-if="Array.isArray(formData.dropoffs) && formData.dropoffs.length > 0">
                                    <table class="w-full text-[12px] border-collapse">
                                      <thead>
                                        <tr class="bg-blue-900 dark:bg-blue-800 text-white">
                                          <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Type</th>
                                          <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Location Name</th>
                                          <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Address</th>
                                          <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">City</th>
                                          <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Zip</th>
                                          <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">State</th>
                                          <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Appointment Date</th>
                                          <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Not Later Than</th>
                                          <th class="px-3 py-2 text-left font-semibold">Not Later Time</th>
                                        </tr>
                                      </thead>

                                      <tbody class="dark:text-gray-200">
                                        <template x-for="(dropoff, index) in formData.dropoffs" :key="index">
                                          <tr>
                                            <td class="px-3 py-2" x-text="dropoff?.drop_at_type || 'N/A'"></td>
                                            <td class="px-3 py-2" x-text="dropoff?.location_name || 'N/A'"></td>
                                            <td class="px-3 py-2" x-text="dropoff?.address || 'N/A'"></td>
                                            <td class="px-3 py-2" x-text="dropoff?.city || 'N/A'"></td>
                                            <td class="px-3 py-2">
                                              <span x-text="dropoff?.zip || 'N/A'"></span>
                                              <span class="text-[10px]" x-text="dropoff?.state || 'N/A'"></span>
                                            </td>
                                            <td class="px-3 py-2"></td>
                                            <td class="px-3 py-2" x-text="dropoff?.appt_date ? new Date(dropoff.appt_date).toLocaleDateString() : ''"></td>
                                            <td class="px-3 py-2" x-text="dropoff?.no_latter_than_date ? new Date(dropoff.no_latter_than_date).toLocaleDateString() : ''"></td>
                                            <td class="px-3 py-2" x-text="dropoff?.no_latter_than_time ? new Date('1970-01-01T' + dropoff.no_latter_than_time).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : ''"></td>
                                          </tr>
                                        </template>
                                      </tbody>
                                    </table>
                                  </template>

                                  <template x-if="!formData.dropoffs || formData.dropoffs.length === 0">
                                    <div 
                                      x-transition
                                      class="p-4 text-center text-sm text-gray-600 dark:text-gray-300 bg-gray-50 dark:bg-gray-800 rounded-md"
                                    >
                                      ðŸ“¦ No dropoffs found.
                                    </div>
                                  </template>
                                </div>




                                   <!-- Charges and Expenses -->
                                <div class="grid grid-cols-2 gap-8 mb-6" x-show="userRole === 'businessadministrator' || userRole === 'customer'">
                                    <!-- Charges Information -->
                                    <div>
                                        <h2 class="text-[16px] font-bold mb-3 dark:text-white">Charges Information</h2>
                                        <template x-if="Array.isArray(formData.shipment_charges) && formData.shipment_charges.length">
                                        <table class="w-full text-[12px] border-collapse">
                                            <thead>
                                                <tr class="bg-blue-900 dark:bg-blue-800 text-white">
                                                    <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Type</th>
                                                    <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Unit</th>
                                                    <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Rate</th>
                                                    <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Amount</th>
                                                    <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Discount</th>
                                                    <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Notes</th>
                                                    <th class="px-3 py-2 text-left font-semibold">Comments</th>
                                                </tr>
                                            </thead>
                                            <tbody class="dark:text-gray-200">
                                               <template x-for="(charge, index) in formData.shipment_charges" :key="index">
                                                <tr>
                                                    <td class="px-3 py-2" x-text="charge.charge_type || charge.type || 'N/A'"></td>
                                                    <td class="px-3 py-2" x-text="charge.unit || 'N/A'"></td>
                                                    <td class="px-3 py-2" x-text="charge.charge_rate ? currency + ' ' + parseFloat(charge.charge_rate).toFixed(2) : 'N/A'"></td>
                                                    <td class="px-3 py-2" x-text="charge.charge_amount ? currency + ' ' + parseFloat(charge.charge_amount).toFixed(2) : 'N/A'"></td>
                                                    <td class="px-3 py-2" x-text="charge.discount ? currency + ' ' + parseFloat(charge.discount).toFixed(2) : 'N/A'"></td>
                                                    <!-- <td class="px-3 py-2"></td> -->
                                                    <td class="px-3 py-2" x-text="charge.internal_note || 'N/A'"></td>
                                                    <td class="px-3 py-2" x-text="charge.comment || 'N/A'"></td>
                                                </tr>
                                                </template>
                                            </tbody>
                                        </table>
                                        </template>
                                    </div>

                                    <!-- Expenses Information -->
                                    <div>
                                        <h2 class="text-[16px] font-bold mb-3 dark:text-white">Expenses Information</h2>
                                          <template x-if="formData.shipment_expenses && formData.shipment_expenses.length > 0">
                                        <table class="w-full text-[12px] border-collapse">
                                            <thead>
                                                <tr class="bg-blue-900 dark:bg-blue-800 text-white">
                                                    <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Type</th>
                                                    <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Unit</th>
                                                    <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Rate</th>
                                                    <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Amount</th>
                                                    <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Discount</th>
                                                    <th class="px-3 py-2 text-left font-semibold border-r border-blue-600">Paid?</th>
                                                    <th class="px-3 py-2 text-left font-semibold">Billed?</th>
                                                </tr>
                                            </thead>
                                            <tbody class="dark:text-gray-200">
                                                <template x-for="(expense, index) in formData.shipment_expenses" :key="expense.id || index">
                                                <tr>
                                                    <td class="px-3 py-2" x-text="expense.expense_type || 'N/A'"></td>
                                                    <td class="px-3 py-2" x-text="expense.unit || 'N/A'"></td>
                                                    <td class="px-3 py-2" x-text="expense.expense_rate ? currency + ' ' + parseFloat(expense.expense_rate).toFixed(2) : 'N/A'"></td>
                                                    <td class="px-3 py-2" x-text="expense.expense_amount ? currency + ' ' + parseFloat(expense.expense_amount).toFixed(2) : 'N/A'"></td>
                                                    <td class="px-3 py-2" x-text="expense.discount ? currency + ' ' + parseFloat(expense.discount).toFixed(2) : 'N/A'"></td>
                                                    <td class="px-3 py-2"  :class="{
                                                        'bg-blue-100 text-blue-800': expense.billed,
                                                        'bg-gray-100 text-gray-800': !expense.billed
                                                      }"
                                                      x-text="expense.billed ? 'Billed' : 'Unbilled'"></td>
                                                    <td class="px-3 py-2" :class="{
                                                        'bg-green-100 text-green-800': expense.paid,
                                                        'bg-yellow-100 text-yellow-800': !expense.paid
                                                      }"
                                                      x-text="expense.paid ? 'Paid' : 'Unpaid'">N/A</td>
                                                </tr>
                                                </template>
                                            </tbody>
                                        </table>
                                        </template>
                                    </div>
                                </div>

                                <!-- Backup Docs -->
                                <div class="mb-6">
                                    <h2 class="text-[16px] font-bold mb-3 dark:text-white">Backup Docs</h2>
                                    <template x-if="Array.isArray(formData.shipment_uploads) && formData.shipment_uploads.length > 0">
                                      <div class="w-12 h-12 border-2 border-gray-300 dark:border-gray-600 rounded flex items-center justify-center bg-gray-50 dark:bg-gray-800">
                                          <div class="grid grid-cols-2 gap-3">
                                        <template x-for="doc in formData.shipment_uploads" :key="doc.id">
                                          <div class="border rounded-lg p-2">
                                            <div class="relative h-32 bg-gray-100 dark:bg-gray-700 rounded-md flex items-center justify-center">
                                              <img :src="doc.file_path" 
                                                  class="max-h-full max-w-full object-contain"
                                                  @error="doc.file_path = '/path/to/placeholder-image.png'">
                                              <a :href="doc.file_path" target="_blank" class="absolute top-2 right-2 text-blue-600 hover:text-blue-800 dark:text-blue-400">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                                                </svg>
                                              </a>
                                            </div>
                                            <p x-text="doc.file_title || 'Untitled'" class="text-xs mt-1 truncate text-center"></p>
                                          </div>
                                        </template>
                                      </div>
                                      </div>
                                    </template>
                                </div>

                                <!-- Black Line Separator -->
                                <div class="w-full h-[3px] bg-black dark:bg-gray-700 mb-6"></div>

                                   <div class="mb-6">
                                      <h2 class="text-[16px] font-bold mb-4 dark:text-white">Shipment Totals</h2>
                                      <div class="space-y-2 text-[13px]">
                                          <div class="flex justify-between dark:text-gray-200">
                                              <span>Shipping Cost</span>
                                              <span class="font-semibold" x-text="currency + ' ' + (formData.shipping_cost || '0.00')"></span>
                                          </div>
                                          <div class="flex justify-between dark:text-gray-200">
                                              <span>Total Fuel Charges (Total Miles: 891.24*$ / Gallon: 3.24/MPG: 6*2)</span>
                                              <span class="font-semibold" x-text="currency + ' ' + (formData.total_fuel_cost || '0.00')"></span>
                                          </div>
                                          <div class="flex justify-between dark:text-gray-200">
                                              <span>Total Charges Cost</span>
                                              <span class="font-semibold" x-text="formData.net_total_charges ? currency + ' ' + parseFloat(formData.net_total_charges).toFixed(2) : 'N/A'"></span>
                                          </div>
                                          <!-- <div class="flex justify-between dark:text-gray-200">
                                              <span>Total Expenses Cost</span>
                                              <span class="font-semibold">USD 1200.00</span>
                                          </div> -->
                                          <div class="flex justify-between font-bold text-[14px] pt-2 dark:text-white">
                                              <span>Total Shipment Cost</span>
                                              <span x-text="currency + ' ' + (formData.total_shipment_cost || '0.00')"></span>
                                          </div>
                                      </div>
                                  </div>
















                                <template x-if="formData.shipment_type === 'ocean'">
                                  <div class="md:col-span-2 lg:col-span-3 font-sans border border-gray-800 dark:border-gray-600 p-2.5">
                                    <h1 class="text-center border-b-2 border-gray-800 dark:border-gray-600 pb-2.5 mb-4 text-lg font-bold text-gray-800 dark:text-white/90">
                                      OCEAN SHIPMENT DETAILS
                                    </h1>

                                    <!-- Basic Information Section -->
                                    <table class="w-full border-collapse mb-4">
                                      <tr>
                                        <td colspan="3" class="border border-gray-800 dark:border-gray-600 p-1.5 bg-gray-100 dark:bg-gray-800">
                                          <strong class="text-sm text-gray-800 dark:text-white/90">BASIC INFORMATION</strong>
                                        </td>
                                      </tr>
                                      <tr>
                                          <td class="border border-gray-300 dark:border-gray-600 p-3 w-1/4">
                                          <p class="text-xs text-gray-500 dark:text-gray-400">Shipment Type</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.shipment_type || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5 w-1/4">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Shipper Name</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData && formData.shipper_name || 'N/A'"></p>
                                        </td>
                                        
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5 w-1/4">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Shipper Address</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.ocean_shipper_address || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5 w-1/4">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Shipper Reference #</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.ocean_shipper_reference_number || 'N/A'"></p>
                                        </td>
                                      </tr>
                                      <tr>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Carrier Name</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData && formData.carrier_name || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Carrier Reference #</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData && formData.carrier_reference_number || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">BOL #</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData && formData.ocean_bill_of_ladening_number || 'N/A'"></p>
                                        </td>
                                      </tr>
                                      <tr>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Consignee</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData && formData.consignee || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Consignee Phone</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData && formData.consignee_phone || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Consignee Email</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.consignee_email || 'N/A'"></p>
                                        </td>
                                      </tr>
                                      <tr>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Notify party Name</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.first_notify_party_name || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Phone</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.first_notify_party_phone || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Email</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.first_notify_party_email || 'N/A'"></p>
                                        </td>
                                      </tr>
                                    <!-- </table> -->

                                    <!-- Additional Info Section -->
                                    <!-- <table class="w-full border-collapse mb-4"> -->
                                      <!-- <tr>
                                        <td colspan="3" class="border border-gray-800 dark:border-gray-600 p-1.5 bg-gray-100 dark:bg-gray-800">
                                          <strong class="text-sm text-gray-800 dark:text-white/90">ADDITIONAL INFO</strong>
                                        </td>
                                      </tr> -->
                                      <tr>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5 w-1/3">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Pre Carried</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.pre_carrier || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5 w-1/3">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Vessel / Aircraft</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.vessel_aircraft_name || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5 w-1/3">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Voyage No</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.voyage_number || 'N/A'"></p>
                                        </td>
                                      </tr>
                                      <tr>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Place of Delivery</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.place_of_delivery || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Final Destination</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.final_destination || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Port of landing</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.port_of_landing || 'N/A'"></p>
                                        </td>
                                      </tr>
                                      <tr>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Additional Note</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.ocean_note || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">ITN</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.itn || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Kind and No of Packages</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.kind_and_no_of_packages || 'N/A'"></p>
                                        </td>
                                      </tr>
                                      <tr>
                                        <td colspan="3" class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Description</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.decsription_of_goods || 'N/A'"></p>
                                        </td>
                                      </tr>
                                    <!-- </table> -->

                                    <!-- Additional Information Section -->
                                    <!-- <table class="w-full border-collapse mb-4"> -->
                                      <!-- <tr>
                                        <td colspan="3" class="border border-gray-800 dark:border-gray-600 p-1.5 bg-gray-100 dark:bg-gray-800">
                                          <strong class="text-sm text-gray-800 dark:text-white/90">ADDITIONAL INFORMATION</strong>
                                        </td>
                                      </tr> -->
                                      <tr>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5 w-1/3">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Net weight (kg)</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.ocean_net_weight || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5 w-1/3">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Gross weight (kg)</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.ocean_gross_weight || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5 w-1/3">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Total</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.ocean_total || 'N/A'"></p>
                                        </td>
                                      </tr>
                                      <tr>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Consignment Total</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.ocean_consignment_total || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Seal #</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.ocean_seal_number || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Equipment Size</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.equipment_size || 'N/A'"></p>
                                        </td>
                                      </tr>
                                      <tr>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">No containers or packages in word</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.ocean_total_containers_in_words || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">No of original Bill of landing</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.no_original_bill_of_landing || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Payable at</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.original_bill_of_landing_payable_at || 'N/A'"></p>
                                        </td>
                                      </tr>
                                      <tr>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Freight Charges</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.ocean_freight_charges || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Shipped on board Date</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.shipped_on_board_date || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Place of Issue</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.place_of_issue || 'N/A'"></p>
                                        </td>
                                      </tr>
                                      <tr>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Signatory Company</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.signatory_company || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Authorize Signatory</p>
                                          <p class="text-sm font-medium text-gray-900 dark:text-gray-100" x-text="formData.authorized_signatory || 'N/A'"></p>
                                        </td>
                                        <td class="border border-gray-800 dark:border-gray-600 p-1.5">
                                          <p class="text-xs text-gray-600 dark:text-gray-400">Signature</p>
                                          <template x-if="formData.ocean_signature">
                                            <img :src="formData.ocean_signature" alt="Signature" class="w-32 h-auto">
                                          </template>
                                          <template x-if="!formData.ocean_signature">
                                            <p class="text-sm font-medium text-gray-900 dark:text-gray-100">N/A</p>
                                          </template>
                                        </td>
                                      </tr>
                                    </table>
                                  </div>
                                </template>
                              </div>

                              
                            </div>
                            </div>
                            

                                   <!-- Footer -->
                                  <div class="bg-gray-50 dark:bg-gray-700 px-6 py-3 border-t border-gray-200 dark:border-gray-600 flex justify-between">
                                    <div class="text-sm text-gray-500 dark:text-gray-400" x-text="'Last updated: ' + (new Date().toLocaleString())"></div>
                                    <div>
                                      <button @click="downloadAsPDF('printableArea')" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition mr-2 no-print">
                                        Download PDF
                                      </button>
                                      <button onclick="printDiv('printableArea')" class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition no-print print-btn">
                                        Print
                                      </button>
                                    </div>
                                  </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </main>
        <!-- ===== Main Content End ===== -->
      </div>
      <!-- ===== Content Area End ===== -->
    </div>
    <!-- ===== Page Wrapper End ===== -->

    <script>
      document.addEventListener('alpine:init', () => {
        Alpine.data('singleItem', () => ({
          id: null,
          formData: {
            office: '',
                  load_type: '',
                  load_type_note: '',
                  load_type_note_r: '',
                  isBroker: '',
                  shipment_type: '',
                  bill_to: '',
                  quick_note: '',
                  container: '',
                  container_size: '',
                  container_type: '',
                  chasis: '',
                  isLoaded: '',
                  chasis_size: '',
                  chasis_type: '',
                  chasis_vendor: '',
                  reference_number: '',
                  booking_number: '',
                  bill_of_laden_number: '',
                  po_number: '',
                  load_weight: '',
                  commodity: '',
                  pieces: '',
                  pick_up_number: '',
                  over_weight: '',
                  tags: [],
                  tagsInput: '',
                  genset_number: '',
                  seal_number: '',
                  broker_batch_number: '',
                  pick_up: '',
                  look_up: '',
                  pick_up_location_name: '',
                  pick_up_address:'',
                  pick_up_address: '',
                  pickup_number: '',
                  pick_up_city: '',
                  zip: '',
                  appt_date: '',
                  from: '',
                  to: '',
                  no_latter_than_date: '',
                  drop_at_no_latter_than_time: '',
                  broker_name: '',
                  broker_email: '',
                  broker_edi_api_shipment_number: '',
                  broker_phone: '',
                  broker_number: '',
                  broker_sales_rep: '',
                  reefer_temp: '',
                  broker_reference_number: '',
                  batch_number: '',
                  batch_req: '',
                  sales_rep: '',
                  edi_number: '',
                  note: '',

                  //miles
                  total_miles:'',
                  loaded_miles:'',
                  empty_miles:'',
                  dh_miles:'',
                  fuel_rate_per_gallon:'',
                  mpg:'',
                  fuel_cototal_fuel_costst:'',

              

                  delivery_type: '',
                  driver_id: '',
                  carrier_id: '',
                  
                
                    shipper_name: '',
                    ocean_shipper_address: '',
                    ocean_shipper_reference_number: '',
                    carrier_name: '',
                    carrier_reference_number: '',
                    ocean_bill_of_ladening_number: '',
                    consignee: '',
                    consignee_phone: '',
                    consignee_email: '',
                    first_notify_party_name: '',
                    first_notify_party_phone: '',
                    first_notify_party_email: '',
                    second_notify_party_name: '',
                    second_notify_party_phone: '',
                    second_notify_party_email: '',
                    pre_carrier: '',
                    port_of_discharge: '',
                    vessel_aircraft_name: '',
                    voyage_number: '',
                    port_of_discharge: '',
                    place_of_delivery: '',
                    final_destination: '',
                    port_of_landing: '',
                    ocean_note: '',
                    ocean_freight_charges: '',
                    ocean_total_containers_in_words: '',
                    no_original_bill_of_landing: '',
                    original_bill_of_landing_payable_at: '',
                    ocean_freight_charges: '',
                    shipped_on_board_date: '',
                    goods_name: '',
                    ocean_vin: '',
                    ocean_weight: '',
                    expense_total: 0,
                    shipment_charges: [],
                    shipment_expenses: [],
                    pickups: [],
                    dropoffs: [],

                credit_total: 0,
                net_expense: 0,
                total: 0,
                total_discount: 0,
                net_total: 0,
            shipment_uploads: []
          },
          
          net_total_charges: '',
          total_discount_charges:'',
          total_charges:'',
          id: null,
          isLoading: true,
          currency: localStorage.getItem('currency') || 'USD',
          userRole: localStorage.getItem('user_role'),

          init() {
            const urlParams = new URLSearchParams(window.location.search);
            const encodedId = urlParams.get('id');
            
            if (encodedId) {
              this.id = atob(encodedId);
              this.fetchData();
            } else {
              console.error('No ID found in the URL');
              this.isLoading = false;
            }
          },

             downloadAsPDF() {
  // Store button state at the start (in case of early errors)
  let button = null;
  let originalButtonText = '';
  
  if (event && event.target) {
    button = event.target;
    originalButtonText = button.innerHTML;
    button.innerHTML = 'Generating PDF...';
    button.disabled = true;
  }

  try {
    const element = document.getElementById('printableArea');
    if (!element) {
      throw new Error('Printable area not found');
    }

    // Clone the element to avoid modifying the original
    const clonedElement = element.cloneNode(true);
    
    // Remove elements with no-print class
    const noPrintElements = clonedElement.querySelectorAll('.no-print');
    noPrintElements.forEach(el => el.remove());
    
    // Add title to the PDF
    const title = document.createElement('h1');
    const referenceText = document.querySelector('[x-text="\'Reference #: \' + (formData.id || \'N/A\')"]')?.textContent || '';
    title.textContent = `Load ${referenceText.replace('Reference #: ', '')}`;
    title.style.textAlign = 'center';
    title.style.marginBottom = '20px';
    title.style.fontSize = '24px';
    clonedElement.insertBefore(title, clonedElement.firstChild);

    // PDF options
    const opt = {
      margin: 10,
      filename: `Load_${referenceText.replace('Reference #: ', '') || new Date().toISOString().split('T')[0]}.pdf`,
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { 
        scale: 2,
        logging: true,
        useCORS: true,
        letterRendering: true,
        allowTaint: true
      },
      jsPDF: { 
        unit: 'mm', 
        format: 'a4', 
        orientation: 'portrait',
        hotfixes: ["px_scaling"] 
      }
    };

    // Return the promise so callers can await it if needed
    return html2pdf()
      .set(opt)
      .from(clonedElement)
      .save()
      .then(() => {
        console.log('PDF generated successfully');
      })
      .catch((pdfError) => {
        console.error('PDF generation failed:', pdfError);
        throw new Error('Failed to generate PDF');
      });
    
  } catch (error) {
    console.error('PDF generation failed:', error);
    alert('Failed to generate PDF. Please try again.');
    throw error; // Re-throw to allow error handling by caller
  } finally {
    // Restore button state if we modified it
    if (button) {
      button.innerHTML = originalButtonText;
      button.disabled = false;
    }
  }
},

          fetchData() {
            this.isLoading = true;
            
            fetch(`${requestURL}/shipments/show/${this.id}`, {
              headers: {
                'Authorization': 'Bearer ' + localStorage.getItem('auth_token'),
                'Accept': 'application/json'
              }
            })
            .then(response => {
              if (!response.ok) throw new Error('Network response was not ok');
              return response.json();
            })
            .then(data => {
              console.log('shipment Response:', data);
              
              // Initialize formData with all required properties
              this.formData = {
                id:data.id || '',
                bill_to: data.invoice?.customer.user.fname || '',
                driver: data.driver?.user.fname || '',
                shipment_type:data.shipment_type || '',
                shipment_tracking_number: data.shipment_tracking_number || '',
                load_type: data.load_type || '',
                load_type_note: data.load_type_note || '',
                //Land shipment data
                shipper_name: data.shipper_name || '',
                shipper_address: data.shipper_address || '',
                shipper_reference_number: data.shipper_reference_number || '',
                carrier_name: data.carrier_name || '',
                carrier_reference_number: data.carrier_reference_number || '',
                bill_of_laden_number: data.bill_of_laden_number || '',
                reference_number: data.reference_number || '',
                pick_up: data.pick_up || '',
                pick_up_address: data.pick_up_address || '',
                pieces: data.pieces || '',
                commodity: data.commodity || '',
                load_weight: data.shipment_weight || '',
                booking_number: data.booking_number || '',
                genset_number: data.genset_number || '',
                reefer_temp: data.reefer_temp || '',
                po_number: data.po_number || '',
                pickup_number:data.pickup_number || '',
                seal_number: data.seal_number || '',
                broker_batch_number: data.broker_batch_number || '',
                broker_email: data.broker_email || '',
                broker_edi_api_shipment_number: data.broker_edi_api_shipment_number || '',
                broker_phone: data.broker_phone || '',
                broker_name: data.broker_name || '',
                broker_number: data.broker_number || '',
                broker_sales_rep: data.broker_sales_rep || '',
                broker_reference_number: data.broker_reference_number || '',
                batch_number: data.batch_number || '',
                sales_rep: data.sales_rep || '',
                edi_number: data.edi_number || '',
                batch_req: data.batch_req || '',
                fuel_rate_per_gallon: data.fuel_rate_per_gallon || '',
                mpg: data.mpg || '',
                over_weight: data.over_weight || [],
                tags: data.tags || [],
                total_miles: data.total_miles || '',
                empty_miles: data.empty_miles || '',
                dh_miles: data.dh_miles || '',
                loaded_miles: data.loaded_miles || '',
                isBroker: data.isBroker || '',
                consignee_name: data.consignee_name || '',
                consignee_phone: data.consignee_phone || '',
                consignee_email: data.consignee_email || '',
                first_notify_party_name: data.first_notify_party_name || '',
                first_notify_party_phone: data.first_notify_party_phone || '',
                first_notify_party_email: data.first_notify_party_email || '',
                second_notify_party_name: data.second_notify_party_name || '',
                second_notify_party_phone: data.second_notify_party_phone || '',
                second_notify_party_email: data.second_notify_party_email || '',
                pre_carrier_name: data.pre_carrier_name || '',
                port_of_discharge: data.port_of_discharge || '',
                vessel_aircraft_name: data.vessel_aircraft_name || '',
                voyage_number: data.voyage_number || '',
                port_of_discharge: data.port_of_discharge || '',
                place_of_delivery: data.place_of_delivery || '',
                final_destination: data.final_destination || '',
                //ocean data
                
                shipper_name: data.shipper_name || '',
                ocean_shipper_address: data.ocean_shipper_address || '',
                ocean_shipper_reference_number: data.ocean_shipper_reference_number || '',
                carrier_name: data.carrier_name || '',
                carrier_reference_number: data.carrier_reference_number || '',
                ocean_bill_of_ladening_number: data.ocean_bill_of_ladening_number || '',
                consignee_name: data.consignee_name || '',
                consignee_phone: data.consignee_phone || '',
                consignee_email: data.consignee_email || '',
                first_notify_party_name: data.first_notify_party_name || '',
                first_notify_party_phone: data.first_notify_party_phone || '',
                first_notify_party_email: data.first_notify_party_email || '',
                second_notify_party_phone: data.second_notify_party_phone || '',
                second_notify_party_email: data.second_notify_party_email || '',
                second_notify_party_name: data.second_notify_party_name || '',
                pre_carrier_name: data.pre_carrier_name || '',
                vessel_aircraft_name: data.vessel_aircraft_name || '',
                voyage_number: data.voyage_number || '',
                port_of_discharge: data.port_of_discharge || '',
                place_of_delivery: data.place_of_delivery || '',
                final_destination: data.final_destination || '',
                port_of_landing: data.port_of_landing || '',
                ocean_note: data.ocean_note || '',
                itn: data.itn || '',
                kind_and_no_of_packages: data.kind_and_no_of_packages || '',
                decsription_of_goods: data.decsription_of_goods || '',
                ocean_net_weight: data.ocean_net_weight || '',
                ocean_gross_weight: data.ocean_gross_weight || '',
                ocean_total_weight: data.ocean_total_weight || '',
                ocean_consignment_total_weight: data.ocean_consignment_total_weight || '',
                ocean_seal_number: data.ocean_seal_number || '',
                equipment_size: data.equipment_size || '',
                ocean_total_containers_in_words: data.ocean_total_containers_in_words || '',
                no_original_bill_of_landing:data.no_original_bill_of_landing || '',
                original_bill_of_landing_payable_at:data.original_bill_of_landing_payable_at || '',
                ocean_freight_charges:data.ocean_freight_charges || '',
                shipped_on_board_date:data.shipped_on_board_date || '',
                place_of_issue:data.place_of_issue || '',
                signatory_company:data.signatory_company || '',
                authorized_signatory:data.authorized_signatory || '',
                ocean_signature:data.ocean_signature || '',
                status:data.status || '',
                
                net_total_charges:data.net_total_charges || '',
                total_discount_charges:data.total_discount_charges || '',
                total_charges:data.total_charges || '',

                shipping_cost:data.shipping_cost || '',
                total_fuel_cost:data.total_fuel_cost || '',
                total_shipment_cost:data.total_shipment_cost || '',




                office: data.office || '',

                invoice_logo: data.branch?.invoice_logo || '',
                invoice_logo_url:data.branch?.invoice_logo_url || '',

                shipment_charges:data.shipment_charges?.map(charge => ({
                  id: charge.id || '',
                  charge_type: charge.charge_type || '',
                  charge_unit: charge.units || '',
                  charge_rate: charge.rate || '',
                  charge_amount: charge.amount || 0,
                  discount: charge.discount || 0,
                  comment: charge.comment || 0
                })) || [],

                shipment_expenses:data.shipment_expenses?.map(expense => ({
                  id: expense.id || '',
                  expense_type: expense.expense_type || '',
                  expense_unit: expense.units || '',
                  expense_rate: expense.rate || '',
                  expense_amount: expense.amount || 0,
                  credit_reimbursement_amount: expense.credit_reimbursement_amount || 0,
                  vendor_invoice_number: expense.vendor_invoice_number || '',
                  payment_reference_note: expense.payment_reference_note || '',
                  disputed_note: expense.disputed_note || '',
                  internal_notes: expense.internal_notes || '',
                  billed: expense.billed || false,
                  paid: expense.paid || false
                })) || [],

                pickups: data.pickups?.map(pickup => ({
                  id: pickup.id,
                  address: pickup.address,
                  city: pickup.city,
                  state:pickup.state,
                  zip: pickup.zip,
                  location_name: pickup.location_name,
                  no_latter_than_date: pickup.no_latter_than_date,
                  no_latter_than_time: pickup.no_latter_than_time,
                  pick_up_type:pickup.pick_up_type,
                  appt_date: pickup.appt_date,

                })) || [],

                dropoffs: data.dropoffs?.map(dropoff => ({
                  id: dropoff.id,
                  address: dropoff.address,
                  city: dropoff.city,
                  state:dropoff.state,
                  zip: dropoff.zip,
                  location_name: dropoff.location_name,
                  no_latter_than_date: dropoff.no_latter_than_date,
                  no_latter_than_time: dropoff.no_latter_than_time,
                  drop_at_type:dropoff.drop_at_type,
                  appt_date: dropoff.appt_date,

                })) || [],

                shipment_uploads:data.shipment_uploads?.map(upload => ({
                  id: upload.id || '',
                  file_path: upload.file_path || ''
                })) || [],
              };
            })
            .catch(error => {
              console.error('Error fetching data:', error);
              // Initialize empty formData even on error
              this.formData = {
                shipment_type: '',
                shipment_uploads: []
              };
            })
            .finally(() => {
              this.isLoading = false;
            });
          }
        }));
      });

   function printDiv(divId) {
    const printElement = document.getElementById(divId);
    const printContents = printElement.innerHTML;
    const originalContents = document.body.innerHTML;
    
    // Replace document body with only the printable area
    document.body.innerHTML = printContents;
    
    // Function to check if all images are loaded
    function checkAllImagesLoaded() {
        return new Promise((resolve) => {
            const images = document.querySelectorAll('img');
            let loadedCount = 0;
            const totalImages = images.length;
            
            if (totalImages === 0) {
                resolve();
                return;
            }
            
            images.forEach(img => {
                if (img.complete) {
                    loadedCount++;
                    if (loadedCount === totalImages) resolve();
                } else {
                    img.addEventListener('load', () => {
                        loadedCount++;
                        if (loadedCount === totalImages) resolve();
                    });
                    img.addEventListener('error', () => {
                        loadedCount++;
                        if (loadedCount === totalImages) resolve();
                    });
                }
            });
        });
    }
    
    // Wait for images to load, then print
    checkAllImagesLoaded().then(() => {
        // Small delay to ensure rendering is complete
        setTimeout(() => {
            window.print();
            // Restore the original document contents
            document.body.innerHTML = originalContents;
            // Since we've replaced the innerHTML, we need to reattach the event listener
            const printButton = document.querySelector('.print-btn');
            if (printButton) {
                printButton.onclick = function() {
                    printDiv('printableArea');
                };
            }
        }, 500);
    });
}   function printDiv(divId) {
            // Store original document contents
            const originalContents = document.body.innerHTML;
            
            // Get the printable area HTML
            const printElement = document.getElementById(divId);
            const printContents = printElement.innerHTML;
            
            // Replace document body with only the printable area
            document.body.innerHTML = printContents;
            
            // Trigger the print dialog
            window.print();
            
            // Restore the original document contents
            document.body.innerHTML = originalContents;
            
            // Since we've replaced the innerHTML, we need to reattach the event listener
            // Alternatively, we could use event delegation or a different approach
            const printButton = document.querySelector('.print-btn');
            if (printButton) {
                printButton.onclick = function() {
                  setTimeout(function(){

                    printDiv('printableArea');
                  }, 5000)
                };
            }
        }
      
      // function printDiv(divId) {
      //   const printContents = document.getElementById(divId).innerHTML;
      //   const originalContents = document.body.innerHTML;
      //   document.body.innerHTML = printContents;
      //   window.print();
      //   document.body.innerHTML = originalContents;
      //   location.reload();
      // }

      async function downloadAsPDF12() {
  try {
    const element = document.getElementById('printableArea');
    if (!element) {
      throw new Error('Printable area not found');
    }

    // Clone the element to avoid modifying the original
    const clonedElement = element.cloneNode(true);
    
    // Remove elements with no-print class
    const noPrintElements = clonedElement.querySelectorAll('.no-print');
    noPrintElements.forEach(el => el.remove());
    
    // Add title to the PDF
    const title = document.createElement('h1');
    const referenceText = document.querySelector('[x-text="\'Reference #: \' + (formData.id || \'N/A\')"]')?.textContent || '';
    title.textContent = `Load ${referenceText.replace('Reference #: ', '')}`;
    title.style.textAlign = 'center';
    title.style.marginBottom = '20px';
    title.style.fontSize = '24px';
    clonedElement.insertBefore(title, clonedElement.firstChild);

    // PDF options
    const opt = {
      margin: 10,
      filename: `Load_${referenceText.replace('Reference #: ', '') || new Date().toISOString().split('T')[0]}.pdf`,
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { 
        scale: 2,
        logging: true,
        useCORS: true,
        letterRendering: true,
        allowTaint: true
      },
      jsPDF: { 
        unit: 'mm', 
        format: 'a4', 
        orientation: 'portrait',
        hotfixes: ["px_scaling"] 
      }
    };

    // Show loading indicator
    const originalButtonText = event.target.innerHTML;
    event.target.innerHTML = 'Generating PDF...';
    event.target.disabled = true;

    // Generate and save PDF
    await html2pdf().set(opt).from(clonedElement).save();
    
  } catch (error) {
    console.error('PDF generation failed:', error);
    alert('Failed to generate PDF. Please try again.');
  } finally {
    // Restore button state
    if (event.target) {
      event.target.innerHTML = originalButtonText;
      event.target.disabled = false;
    }
  }
}


      function downloadAsPDFER() {
  const element = document.getElementById('printableArea');
  const clonedElement = element.cloneNode(true);
  
  // Remove buttons and other elements you don't want in the PDF
  const buttons = clonedElement.querySelectorAll('.no-print');
  buttons.forEach(button => button.remove());
  
  // Add a title to the PDF
  const title = document.createElement('h1');
  title.textContent = 'Loads #' + (document.querySelector('[x-text="\'Reference #: \' + (formData.id || \'N/A\')"]')?.textContent || '');
  title.style.textAlign = 'cnter';
  title.style.marginBottom = '20px';
  clonedElement.insertBefore(title, clonedElement.firstChild);
  
  const opt = {
    margin: 10,
    filename: 'Loads_' + (new Date().toISOString().split('T')[0]) + '.pdf',
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { 
      scale: 2,
      logging: true,
      useCORS: true
    },
    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
  };

  html2pdf().set(opt).from(clonedElement).save();
}
    </script>
  </body>
</html>